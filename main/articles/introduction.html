<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>`phase1b`: Tools for Decision Making in Phase 1b Studies • phase1b</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="`phase1b`: Tools for Decision Making in Phase 1b Studies">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phase1b</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">`phase1b`: Tools for Decision Making in Phase 1b Studies</a></li>
    <li><a class="dropdown-item" href="../articles/test.html">test</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/genentech/phase1b"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>`phase1b`: Tools for Decision Making in Phase 1b Studies</h1>
                        <h4 data-toc-skip class="author">Audrey Yeo</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:audrey.yeo@roche.com" class="email">audrey.yeo@roche.com</a>
      
                              <h4 data-toc-skip class="author">Tony
Pourmohamad</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:pourmoht@gene.com" class="email">pourmoht@gene.com</a>
      
                              <h4 data-toc-skip class="author">Jiawen
Zhu</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:zhu.jiawen@gene.com" class="email">zhu.jiawen@gene.com</a>
      
                              <h4 data-toc-skip class="author">Daniel
Sabanes Bove</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:daniel@rconis.com" class="email">daniel@rconis.com</a>
      
                  
      
      <small class="dont-index">Source: <a href="https://github.com/genentech/phase1b/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="intro">Introduction<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p>This short vignette serves as an introduction into the usage of the
R-package <code>phase1b</code>. In particular, the vignette covers
installation of the R-package <code>phase1b</code>, some of the core
methodology used in the R-package <code>phase1b</code>, and lastly some
illustrating examples of its use in clinical trials. The
<code>phase1b</code> R-package is intended to be used when conducting
drug combination studies in Phase 1b trials and is especially useful for
decision making in Phase 1b trials. However, the methodology is
generalizable to many scenarios outside of Phase 1b studies and should
be viewed as a general Bayesian framework for analysis of clinical
trials and more. The focus of the current vignette though is solely on
the application in Phase 1b oncology clinical trials.</p>
<div class="section level3">
<h3 id="audience">Intended Audience<a class="anchor" aria-label="anchor" href="#audience"></a>
</h3>
<p>This document is intended to familiarize a (potential) user of
<code>phase1b</code> with the models and analyses available in the
R-package. After a brief overview, the bulk of this document consists of
examples in oncology clinical trials which illustrate the various
functions and methodologies implemented by the R-package.</p>
<p>Note that this tutorial was not meant to serve as an instruction
manual. For more detailed documentation of the functions contained in
the R-package, see the R-package help-manuals. At an R prompt, type</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"phase1b"</span><span class="op">)</span></span></code></pre></div>
<p>Additional examples can be found in the demo files for this
R-package, which can be listed by:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/demo.html" class="external-link">demo</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"phase1b"</span><span class="op">)</span></span></code></pre></div>
<p>and afterwards called by supplying the name of the demo file to the
<code><a href="https://rdrr.io/r/utils/demo.html" class="external-link">demo()</a></code> function.</p>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The first time you use <code>phase1b</code> on your own computer you
will need to download and install it, however, subsequent use will only
require calling of the R-package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"phase1b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>Before being able to run any of the commands in the
<code>phase1b</code> R-package, you will have to load the R-package
(assuming the R-package has been installed following the instructions in
the <a href="#installation">Installation section</a> with the following
command:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/genentech/phase1b/" class="external-link">phase1b</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>Once loaded, you will have access to all of the functions in the
<code>phase1b</code> R-package. To see a list of all of the functions in
the <code>phase1b</code> R-package, and for browsing their associated
help pages, you should execute the following command:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"phase1b"</span><span class="op">)</span></span></code></pre></div>
<p>A list of functions will be displayed and you can learn more about
each function, and see examples of its use, by clicking on its
corresponding link. Note that this will easiest work in <a href="https://posit.co/download/rstudio-desktop/" class="external-link">R-Studio</a>, which is
the recommended software for editing and using R.</p>
</div>
<div class="section level2">
<h2 id="methods">Methods and Models<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<p>This section provides a brief overview of the statistical models and
methods implemented by the <code>phase1b</code> R-package. The
underlying methodology is rooted in the Bayesian paradigm and an
understanding of Bayesian statistics at the level of e.g. <span class="citation">Gelman et al. (2013)</span> or <span class="citation">Held and Sabanés Bové (2015)</span> is recommended. The
<a href="#methods">methods section</a> provides the reader with the
basics needed to understand the <code>phase1b</code> R-package, but
those interested in learning more about Bayesian statistics, and their
applications to clinical trials, are encouraged to read <span class="citation">Gelman et al. (2013)</span>,<span class="citation">Held
and Sabanés Bové (2015)</span> or <span class="citation">Berry et al.
(2011)</span>, respectively, for more details.</p>
<p>As a first pass on this document, it might make sense to the reader
to skip this section and go straight on to the <a href="#examples">examples</a>.</p>
<div class="section level3">
<h3 id="postdist">Posterior Distribution<a class="anchor" aria-label="anchor" href="#postdist"></a>
</h3>
<p>As a starting point, we review the basic fundamental approach in
Bayesian statistics. The Bayesian approach models both the observed data
and any unknown parameters as random variables, and provides a cohesive
framework for combining complex data models with external knowledge,
expert opinion, or both. Here we introduce the main workhorse of the
Bayesian approach, the <em>posterior distribution</em>, and its
technical details as follows.</p>
<p>We start by specifying the distributional model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛉</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(\mathbf{x}\,\vert\,\boldsymbol{\theta})</annotation></semantics></math>
for the observed data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐱</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{x}=(x_1,\ldots,x_n)</annotation></semantics></math>
given a vector of unknown parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝛉</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>θ</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{\theta}=(\theta_1,\ldots,\theta_n)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛉</mi><annotation encoding="application/x-tex">\boldsymbol{\theta}</annotation></semantics></math>
is a random quantity sampled from a <em>prior</em> distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda})</annotation></semantics></math>.
Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛌</mi><annotation encoding="application/x-tex">\boldsymbol{\lambda}</annotation></semantics></math>
is a vector of hyperparameters that are associated with the parameters
of the prior distribution. For instance,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math>
might be the empirical drug response rate in a sample of women aged 40
and over from clinical center
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\theta_i</annotation></semantics></math>
the underlying true response rate for all such women in this center, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛌</mi><annotation encoding="application/x-tex">\boldsymbol{\lambda}</annotation></semantics></math>
a parameter controlling how these true rates vary across centers.
Modeling the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\theta_i</annotation></semantics></math>
as random (instead of fixed) effects allows us to induce specific
correlation structures among them, and hence among the observations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math>
as well.</p>
<p>If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛌</mi><annotation encoding="application/x-tex">\boldsymbol{\lambda}</annotation></semantics></math>
is known then all inference concerning
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛉</mi><annotation encoding="application/x-tex">\boldsymbol{\theta}</annotation></semantics></math>
is based on its posterior distribution,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝐱</mi><mo>,</mo><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mo>,</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mo>,</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mo>∫</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mo>,</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mo>∫</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>𝛉</mi></mrow></mfrac><mi>.</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>e</mi><mi>q</mi><mo>:</mo><mi>p</mi><mi>o</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>o</mi><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
p(\boldsymbol{\theta}\,\vert\,\mathbf{x},\boldsymbol{\lambda})
= \frac{p(\mathbf{x},\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda})}{p(\mathbf{x}\,\vert\,\boldsymbol{\lambda})}
= \frac{p(\mathbf{x},\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda})}{\int p(\mathbf{x},\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda})}
= \frac{f(\mathbf{x}\,\vert\,\theta)\pi(\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda})}{\int f(\mathbf{x}\,\vert\,\theta)\pi(\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda}) d\boldsymbol{\theta}}.
(\#eq:posterior)
\end{equation}</annotation></semantics></math></p>
<p>Notice the contribution of both the data (in the form of the
likelihood
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>)
and the previous knowledge or expert opinion (in the form of the prior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>)
to the posterior. Since, in practice,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛌</mi><annotation encoding="application/x-tex">\boldsymbol{\lambda}</annotation></semantics></math>
will not be known, a second stage (or hyperprior) distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(\boldsymbol{\lambda})</annotation></semantics></math>
will often be required, and @ref(eq:posterior) will be replaced with</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝐱</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mo>,</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mo>,</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mo>∫</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mo>,</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mrow><mo>∫</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>𝛌</mi></mrow><mrow><mo>∫</mo><mo>∫</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐱</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛉</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛌</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>𝛉</mi><mi>d</mi><mi>𝛌</mi></mrow></mfrac><mi>.</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>e</mi><mi>q</mi><mo>:</mo><mi>h</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>p</mi><mi>o</mi><mi>s</mi><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
p(\boldsymbol{\theta}\,\vert\,\mathbf{x})
=\frac{p(\mathbf{x},\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda})}{p(\mathbf{x}\,\vert\,\boldsymbol{\lambda})}
=\frac{p(\mathbf{x},\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda})}{\int p(\mathbf{x},\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda})}
=\frac{\int f(\mathbf{x}\,\vert\,\theta)\pi(\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda})h(\boldsymbol{\lambda})d\boldsymbol{\lambda}}{\int\int f(\mathbf{x}\,\vert\,\theta)\pi(\boldsymbol{\theta}\,\vert\,\boldsymbol{\lambda})h(\boldsymbol{\lambda}) d\boldsymbol{\theta}d\boldsymbol{\lambda}}.
(\#eq:hier-post)
\end{equation}</annotation></semantics></math></p>
<p>This multi-stage approach is often called hierarchical modeling. A
computational challenge in applying Bayesian methods is that for most
realistic problems, the integrations required to do inference under
@ref(eq:posterior) are often not tractable in closed form, and thus must
be approximated numerically. Forms for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
(called <em>conjugate priors</em>) that enable at least partial analytic
evaluation of these integrals may often be found, but in the presence of
nuisance parameters, some intractable integrations remain.</p>
<p>We further illustrate the concept of the posterior distribution, its
calculations, and its use, via exploring the underlying methodology
implemented in the <code>phase1b</code> R-package
function<code><a href="../reference/postprob.html">postprob()</a></code>. The <code><a href="../reference/postprob.html">postprob()</a></code> function
assumes that the observed data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
arise from a Binomial distribution of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
with unknown parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>E</mi></msub><annotation encoding="application/x-tex">P_E</annotation></semantics></math>,
i.e.,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>n</mi><mo>,</mo><msub><mi>P</mi><mi>E</mi></msub><mo>∼</mo><mtext mathvariant="normal">Binom</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>,</mo><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
x\,\vert\,n,P_E\sim\text{Binom}(n,P_E)
\end{equation}</annotation></semantics></math></p>
<p>Under the Bayesian approach, the parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>E</mi></msub><annotation encoding="application/x-tex">P_E</annotation></semantics></math>
is treated as a random unknown quantity in the model. The prior
distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>E</mi></msub><annotation encoding="application/x-tex">P_E</annotation></semantics></math>
can be elicited from external knowledge or expert opinion, however, the
use of a conjugate prior is employed here. The prior used in
<code><a href="../reference/postprob.html">postprob()</a></code> is of the following form: <span class="math inline">$P_E\sim \sum_i=1}^kw_i\text{Beta}(a_i,b_i)$</span>,
so a mixture of Beta distributions, but for simplicity, the default
prior in <code><a href="../reference/postprob.html">postprob()</a></code> is set to be the single conjugate Beta
distribution,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(\alpha,\beta)</annotation></semantics></math>.
Here we make the assumption that a (mixture) Beta prior is a reasonable
choice for the prior distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>E</mi></msub><annotation encoding="application/x-tex">P_E</annotation></semantics></math>.
To derive the posterior distribution, based on this prior assumption, we
have the following:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mo>∫</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><msub><mi>P</mi><mi>E</mi></msub></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>∝</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>∝</mo><msubsup><mi>P</mi><mi>E</mi><mi>x</mi></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>n</mi><mo>−</mo><mi>x</mi></mrow></msup><msubsup><mi>P</mi><mi>E</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>b</mi><mo>−</mo><mn>1</mn></mrow></msup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>∝</mo><msubsup><mi>P</mi><mi>E</mi><mrow><mi>a</mi><mo>+</mo><mi>x</mi><mo>−</mo><mn>1</mn></mrow></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>b</mi><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo>−</mo><mn>1</mn></mrow></msup></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
p(P_E\,\vert\,x)
&amp;=\frac{p(x\,\vert\,P_E)\pi(P_E)}{\int p(x\,\vert\,P_E)\pi(P_E) dP_E}\\
&amp;\propto p(x\,\vert\,P_E)\pi(P_E)\\
&amp;\propto P_E^x(1-P_E)^{n-x}P_E^{a-1}(1-P_E)^{b-1}\\
&amp;\propto P_E^{a+x-1}(1-P_E)^{b+n-x-1}
\end{align*}</annotation></semantics></math></p>
<p>Realizing that densities must integrate to 1, we just need to figure
out what the normalizing constants are for this proportional density.
Using conjugacy, we realize that the posterior distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>E</mi></msub><annotation encoding="application/x-tex">P_E</annotation></semantics></math>
must also follow the same form as the prior distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>E</mi></msub><annotation encoding="application/x-tex">P_E</annotation></semantics></math>,
and thus we recognize that the posterior distribution is the following
Beta distribution
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>E</mi></msub><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo>∼</mo><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>+</mo><mi>x</mi><mo>,</mo><mi>b</mi><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
P_E\,\vert\,x\sim\text{Beta}(a+x,b+n-x)
\end{equation}</annotation></semantics></math></p>
<p>Here we illustrate a posterior of a simple prior as an illustration
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>E</mi></msub><mo>∼</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></msubsup><msub><mi>w</mi><mi>i</mi></msub><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo>,</mo><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_E\sim \sum_{j=1}^kw_i\text{Beta}(a_j,b_j)</annotation></semantics></math>.
In section @ref(updateposterior), we illustrate a mixture Beta
distribution and how weights and parameters are updated with data.</p>
<p>All further probabilistic calculations follow naturally under the
Bayesian approach once the posterior distribution has been identified.
For example, as seen in the function <code><a href="../reference/postprob.html">postprob()</a></code>, one could
calculate the posterior probability that the rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>E</mi></msub><annotation encoding="application/x-tex">P_E</annotation></semantics></math>
is greater than (or less than) some threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>,
i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mi>p</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{P}(P_E&gt;p\,\vert\,x)</annotation></semantics></math>,
by simply calculating the area under the corresponding Beta
distribution.</p>
</div>
<div class="section level3">
<h3 id="updateposterior">Updating Posterior Distribution parameters and weights<a class="anchor" aria-label="anchor" href="#updateposterior"></a>
</h3>
<p>In order to incorporate prior information and evaluate posterior
probabilities, updated weights and parameters are required especially
where mixed Beta-Binomial distribution is involved. To demonstrate the
calculation of how parameters and weights are updated, we illustrate the
reasoning as follows.</p>
<p>We present the Binomial likelihood and the mixture of Beta
distributions prior to begin:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="false" form="prefix">|</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mi>n</mi><mi>k</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>π</mi><mi>x</mi></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>n</mi><mo>−</mo><mi>x</mi></mrow></msup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><msub><mi>w</mi><mi>j</mi></msub><mfrac><mn>1</mn><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><msup><mi>π</mi><mrow><msub><mi>α</mi><mi>j</mi></msub><mo>−</mo><mn>1</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><msub><mi>β</mi><mi>j</mi></msub><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>e</mi><mi>q</mi><mo>:</mo><mi>b</mi><mi>i</mi><mi>n</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>a</mi><mi>l</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
f(x|\pi) &amp;= \binom{n}{k} \pi^x (1-\pi)^{n-x} \\
f(\pi) &amp;= \sum_{j = 1}^{k} w_j \frac {1} {B(\alpha_j, \beta_j)} \pi^{\alpha_j-1} (1-\pi)^{\beta_j-1}
(\#eq:binomial)
\end{align}</annotation></semantics></math><!-- (\#eq:weightedBetaPrior) --></p>
<p>Where the sum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>j</mi></msub><annotation encoding="application/x-tex">w_j</annotation></semantics></math>
has to equal 1:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></msubsup><msub><mi>w</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_{j = 1}^{k} w_j = 1</annotation></semantics></math>.</p>
<p>Each component
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
has the Beta density:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>π</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>α</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><msup><mi>π</mi><mrow><msub><mi>α</mi><mi>j</mi></msub><mo>−</mo><mn>1</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><msub><mi>β</mi><mi>j</mi></msub><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>e</mi><mi>q</mi><mo>:</mo><mi>u</mi><mi>n</mi><mi>w</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>B</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>P</mi><mi>r</mi><mi>i</mi><mi>o</mi><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
f(\pi | \alpha_j, \beta_j) = \frac {1} {B(\alpha_j, \beta_j)} \pi^{\alpha_j-1} (1-\pi)^{\beta_j-1}
(\#eq:unweightedBetaPrior)
\end{align}</annotation></semantics></math></p>
<p>Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">B(\alpha, \beta)</annotation></semantics></math>
is the beta function evaluated with parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.
Then, the product of likelihood and prior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>π</mi><mo stretchy="false" form="prefix">|</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>∝</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="false" form="prefix">|</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(\pi | x) \propto f(\pi) f(x | \pi)</annotation></semantics></math>
gives the kernel for the posterior where we exclude the normalising
constants
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><annotation encoding="application/x-tex">\frac{1}{f(x)}</annotation></semantics></math>
as well as any other multiplicative constants not depending on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>π</mi><mo stretchy="false" form="prefix">|</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>∝</mo><msup><mi>π</mi><mi>x</mi></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>n</mi><mo>−</mo><mi>x</mi></mrow></msup><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><mspace width="0.222em"></mspace><msub><mi>w</mi><mi>j</mi></msub><mfrac><mn>1</mn><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><msup><mi>π</mi><mrow><msub><mi>α</mi><mi>j</mi></msub><mo>−</mo><mn>1</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><msub><mi>β</mi><mi>j</mi></msub><mo>−</mo><mn>1</mn></mrow></msup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>∝</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><mfrac><msub><mi>w</mi><mi>j</mi></msub><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><msup><mi>π</mi><mrow><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>−</mo><mn>1</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo>−</mo><mn>1</mn></mrow></msup><mfrac><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>e</mi><mi>q</mi><mo>:</mo><mi>r</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>W</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>B</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
 f(\pi | x) &amp;\propto \pi^x (1-\pi)^{n-x}\sum_{j = 1}^{k} \ w_j \frac {1}{B(\alpha_j, \beta_j)} \pi^{\alpha_j-1}(1-\pi)^{\beta_j-1}
\\
&amp;\propto \sum_{j = 1}^{k} \frac {w_j}{B(\alpha_j, \beta_j)} \pi^{\alpha_j + x -1} (1-\pi)^{\beta_j + n - x -1} \frac{B(\alpha_j + x, \beta_j + n - x)}{B(\alpha_j + x, \beta_j + n - x)}
 (\#eq:rearrangingWeightedBayes)
 \end{align}</annotation></semantics></math></p>
<p>From @ref(eq:rearrangingWeightedBayes), we know that the updated Beta
prior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>π</mi><mo stretchy="false" form="prefix">|</mo><mi>α</mi><mo>+</mo><msub><mi>x</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mi>B</mi><mi>e</mi><mi>t</mi><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><msup><mi>π</mi><mrow><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>−</mo><mn>1</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">f(\pi | \alpha + x_j, \beta_j + n -x) = \frac {1} {Beta(\alpha_j + x, \beta_j + n - x)}\pi^{\alpha_j + x -1} (1-\pi)^{\beta_j + n - x -1}</annotation></semantics></math>
is embedded and can be simplified to the following:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>π</mi><mo stretchy="false" form="prefix">|</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>∝</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><msub><mi>w</mi><mi>j</mi></msub><mfrac><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>π</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>e</mi><mi>q</mi><mo>:</mo><mi>s</mi><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>d</mi><mi>W</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>B</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>s</mi><mi>o</mi><mi>n</mi><mi>e</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
 f(\pi | x) \propto \sum_{j = 1}^{k}  {w_j} \frac {B(\alpha_j + x, \beta_j +n -x )}{B(\alpha_j, \beta_j)} f(\pi | \alpha_j + x, \beta_j + n - x)
 (\#eq:simplifiedWeightedBayesone)
  \end{align}</annotation></semantics></math><br>
We can identify the shape of the density as that of a mixture
distribution with weights being proportional to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>j</mi></msub><annotation encoding="application/x-tex">w_j</annotation></semantics></math>
: </p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>π</mi><mo stretchy="false" form="prefix">|</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>∝</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><msub><mi>w</mi><mi>j</mi></msub><mfrac><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>e</mi><mi>q</mi><mo>:</mo><mi>s</mi><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>d</mi><mi>W</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>B</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>w</mi><mi>o</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
f(\pi | x) \propto \sum_{j = 1}^{k} w_j \frac {B(\alpha_j + x, \beta_j + n -x )}{B(\alpha_j, \beta_j)}
 (\#eq:simplifiedWeightedBayestwo)
 \end{align}</annotation></semantics></math><br>
The normalizing constant is thus:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mfrac><mn>1</mn><mrow><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><msub><mi>w</mi><mi>j</mi></msub><mfrac><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>e</mi><mi>q</mi><mo>:</mo><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
\frac {1}{\sum_{j=1}^{k}w_j\frac{B(\alpha_j + x, \beta_j + n - x)}{B(\alpha_j, \beta_j)}}
 (\#eq:normalizingconstant)
\end{align}</annotation></semantics></math></p>
<p>such that the updated weights are given as :<br><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mover><mi>w</mi><mo accent="true">̃</mo></mover><mi>j</mi></msub><mo>=</mo><msub><mi>w</mi><mi>j</mi></msub><mfrac><mfrac><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mrow><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>w</mi><mi>j</mi></msub><mfrac><mrow><mi>B</mi><mi>e</mi><mi>t</mi><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>+</mo><mi>x</mi><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>e</mi><mi>q</mi><mo>:</mo><mi>c</mi><mi>a</mi><mi>l</mi><mi>c</mi><mi>w</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
\tilde{w}_j = w_j \frac {\frac {B(\alpha_j + x, \beta_j +n -x )}{B(\alpha_j, \beta_j)}} {\sum_{j} w_j  \frac {Beta(\alpha_j + x, \beta_j +n -x )}{B(\alpha_j, \beta_j)}}
(\#eq:calcweights)
\end{align}</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="betadiff">Difference in beta random variables<a class="anchor" aria-label="anchor" href="#betadiff"></a>
</h3>
<p>One may wish to know the distribution of the difference in response
rates between groups. Recall that, under previous assumptions, we can
characterize the posterior distribution of the group response rate as a
Beta distribution. Thus, under the Bayesian approach, we can describe
the distribution of the difference in response rates between groups
simply as the distribution of the difference of two Beta random
variables. Once again, this idea generalizes to the case of a Beta
mixture prior, however, for sake of argument, we focus on the simpler
case. To better understand the underlying methodology implemented in the
<code>phase1b</code> R-package, consider the following probabilistic
calculations.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
be two independent random variables where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>∼</mo><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>x</mi></msub><mo>,</mo><msub><mi>b</mi><mi>x</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X\sim \text{Beta}(a_x,b_x)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>∼</mo><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>y</mi></msub><mo>,</mo><msub><mi>b</mi><mi>y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y\sim \text{Beta}(a_y,b_y)</annotation></semantics></math>.
Of interest is calculating the distribution of the difference of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
and so, in order to do so, we can utilize a transformation of variables
by defining the following random variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><mi>Y</mi><mo>−</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">Z=Y-X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">W=X</annotation></semantics></math>.
Recalling basic probability theory, we have that determinant of the
Jacobian matrix of this transformation is as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mrow><mo stretchy="true" form="prefix">|</mo><mi>J</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">|</mo><mtext mathvariant="normal">det</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mfrac><mrow><mi>d</mi><mi>X</mi></mrow><mrow><mi>d</mi><mi>W</mi></mrow></mfrac></mtd><mtd columnalign="center" style="text-align: center"><mfrac><mrow><mi>d</mi><mi>X</mi></mrow><mrow><mi>d</mi><mi>Z</mi></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"></mtd><mtd columnalign="center" style="text-align: center"></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mfrac><mrow><mi>d</mi><mi>Y</mi></mrow><mrow><mi>d</mi><mi>W</mi></mrow></mfrac></mtd><mtd columnalign="center" style="text-align: center"><mfrac><mrow><mi>d</mi><mi>Y</mi></mrow><mrow><mi>d</mi><mi>Z</mi></mrow></mfrac></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">|</mo><mtext mathvariant="normal">det</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>−</mi><mn>1</mn></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">|</mo><mn>1</mn><mo>×</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>0</mn><mo>×</mo><mn>1</mn><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><mn>1</mn><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\left\vert J\right\vert = \left |\text{det}\begin{bmatrix}
\frac{dX}{dW} &amp; \frac{dX}{dZ}\\
 &amp; \\
\frac{dY}{dW} &amp; \frac{dY}{dZ}
\end{bmatrix}\right | =
\left |\text{det}\begin{bmatrix}
1 &amp; 0\\
1 &amp; -1
\end{bmatrix}\right | =  |1\times(-1)-0\times1|=1,
\end{align*}</annotation></semantics></math></p>
<p>and thus the joint distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
is the following:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>J</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>J</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mrow><mo stretchy="true" form="prefix">|</mo><mi>J</mi><mo stretchy="true" form="postfix">|</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo>,</mo><mi>w</mi><mo>−</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo>−</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo>;</mo><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><msub><mi>b</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo>−</mo><mi>z</mi><mo>;</mo><msub><mi>a</mi><mn>2</mn></msub><mo>,</mo><msub><mi>b</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mn>1</mn><mo>−</mo><msub><mi>a</mi><mn>1</mn></msub></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mn>1</mn><mo>−</mo><msub><mi>b</mi><mn>1</mn></msub></mrow></msup></mrow><mrow><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><msub><mi>b</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>×</mo><mfrac><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo>−</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mn>1</mn><mo>−</mo><msub><mi>a</mi><mn>2</mn></msub></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo>−</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mn>1</mn><mo>−</mo><msub><mi>b</mi><mn>2</mn></msub></mrow></msup></mrow><mrow><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mn>2</mn></msub><mo>,</mo><msub><mi>b</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
p(z,w)
&amp;=p(J_1(z,w),J_2(z,w))\times|J|\\
&amp;=p(w,w-z)\times 1\\
&amp;=p(w) p(w-z)\\
&amp;=\text{Beta}(w;a_1,b_1)\times\text{Beta}(w-z;a_2,b_2)\\
&amp;=\frac{(w)^{1-a_1}(1-w)^{1-b_1}}{\beta(a_1,b_1)}\times\frac{(w-z)^{1-a_2}(1-(w-z))^{1-b_2}}{\beta(a_2,b_2)}.
\end{align}</annotation></semantics></math></p>
<p>Recalling that we are interested in the distribution of the
difference of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
i.e., p(z), we must marginalize over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math>
in order to recover this distribution. However, this integration is not
trivial, and caution must be used to ensure proper integration over the
correct domain of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(z,w)</annotation></semantics></math>.
For ease of understanding, Figure @ref(fig:betadiff) depicts the domain
of the joint distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(z,w)</annotation></semantics></math>
where the area has been split into two triangles to assist visually with
the appropriate integral needed to marginalize over the domain of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math>.</p>
<div class="figure">
<img src="introduction_files/figure-html/betadiff-1.png" alt="The shaded region show the domain of the joint distribution of $Z$ and $W$. We shade the two triangular regions grey and blue for sake of understanding the bounds of integration necessary for marginalization over $w$ out of the joint distribution." width="700"><p class="caption">
The shaded region show the domain of the joint distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>.
We shade the two triangular regions grey and blue for sake of
understanding the bounds of integration necessary for marginalization
over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math>
out of the joint distribution.
</p>
</div>
<p>Marginalizing the joint distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(w,z)</annotation></semantics></math>
over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math>
results in the following marginal distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>∫</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>w</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mo>∫</mo><mn>0</mn><mrow><mi>z</mi><mo>+</mo><mn>1</mn></mrow></msubsup><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>w</mi><mspace width="0.167em"></mspace></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mo>−</mo><mn>1</mn><mo>≤</mo><mi>z</mi><mo>≤</mo><mn>0</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mo>∫</mo><mi>z</mi><mn>1</mn></msubsup><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>w</mi><mspace width="0.167em"></mspace></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mphantom><mo>−</mo></mphantom><mn>0</mn><mo>&lt;</mo><mi>z</mi><mo>≤</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn><mspace width="0.167em"></mspace></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise</mtext></mtd></mtr></mtable></mrow></mtd></mtr></mtable><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>e</mi><mi>q</mi><mo>:</mo><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>d</mi><mi>i</mi><mi>f</mi><mi>f</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\begin{align}
p(z)=\int p(z,w) dw =
\begin{cases}
\int_{0}^{z+1} p(z,w)dw \,  &amp;\mbox{if } -1 \leq z \leq 0 \\ \\
\int_{z}^{1} p(z,w)dw \,  &amp;\mbox{if } \phantom{-}0 &lt; z \leq 1 \\ \\
0 \,  &amp;\mbox{otherwise}
\end{cases}
\end{align}
(\#eq:betadiff)
</annotation></semantics></math> Thus the distribution of the difference
of two beta random variables can be characterized by @ref(eq:betadiff).
However, these integrals are not analytically tractable and so we
approximate them using <code>R</code>’s built-in
<code><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate()</a></code> function inside of the <code>phase1b</code>
R-package function <code>betadiff()</code>.</p>
</div>
<div class="section level3">
<h3 id="predprob">Predictive Probabilities<a class="anchor" aria-label="anchor" href="#predprob"></a>
</h3>
<p>Rather than reconstruct the argument of predictive probability
calculations completely, the reader is advised to see the book <span class="citation">Berry et al. (2011)</span> for further discussion on
the topic. Here we quote parts of pages 142 – 144 of <span class="citation">Berry et al. (2011)</span> to better understand the
methodology of <em>predictive probability</em> that is implemented in
the functions <code>predprob</code>, <code>odPredprob</code> etc.</p>
<div class="section level4">
<h4 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h4>
<p>A distinct advantage of the predictive probability (PP) approach is
that it mimics the clinical decision making process. Based on the
interim data, PP is obtained by calculating the probability of a
positive conclusion (rejecting the null hypothesis) should the trial be
conducted to the maximum planned sample size. In this framework, the
chance that the trial will show a conclusive result at the end of the
study, given the current information, is evaluated. The decision to
continue or to stop the trial can be made according to the strength of
this predictive probability. In what follows, we quote directly <span class="citation">Berry et al. (2011)</span> and explain the definition
and basic calculations for binary data.</p>
<p>Suppose our goal is to evaluate the response rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>E</mi></msub><annotation encoding="application/x-tex">P_E</annotation></semantics></math>
for a new drug by testing the hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>P</mi><mi>E</mi></msub><mo>≤</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">H_0: P_E \leq p</annotation></semantics></math>
versus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>A</mi></msub><mo>:</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">H_A: P_E &gt; p</annotation></semantics></math>.
Suppose we assume that the prior distribution of the response rate,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(P_E)</annotation></semantics></math>,
follows a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(a,b)</annotation></semantics></math>
distribution. The quantity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">a/(a+b)</annotation></semantics></math>
gives the prior mean, while the magnitude of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a+b</annotation></semantics></math>
indicates how informative the prior is. Since the quantities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>
can be considered as the numbers of effective prior responses and
non-responses, respectively,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a+b</annotation></semantics></math>
can be thought of as a measure of prior precision: the larger this sum,
the more informative the prior and the stronger the belief it
contains.</p>
<p>Suppose we set a maximum number of accrued patients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mo>max</mo></msub><annotation encoding="application/x-tex">N_{\max}</annotation></semantics></math>,
and assume that the number of responses
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
among the current
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
patients
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>≤</mo><msub><mi>N</mi><mo>max</mo></msub></mrow><annotation encoding="application/x-tex">n\leq N_{\max}</annotation></semantics></math>)
follows a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Binom</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>,</mo><msub><mi>P</mi><mi>E</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Binom}(n, P_E)</annotation></semantics></math>
distribution. By the conjugacy of the beta prior and binomial
likelihood, the posterior distribution of the response rate follows
another a beta distribution,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo>∼</mo><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>+</mo><mi>x</mi><mo>,</mo><mi>b</mi><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P\,\vert\,x \sim \text{Beta}(a + x, b+ n - x)</annotation></semantics></math>.The
predictive probability approach looks into the future based on the
current observed data to project whether a positive conclusion at the
end of study is likely or not, and then makes a sensible decision at the
present time accordingly.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
be the number of responses in the potential
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><msub><mi>N</mi><mo>max</mo></msub><mo>−</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m = N_{\max}-n</annotation></semantics></math>
future patients. Suppose our design is to declare efficacy if the
posterior probability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>E</mi></msub><annotation encoding="application/x-tex">P_E</annotation></semantics></math>
exceeding some prespecified level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is greater than some threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>T</mi></msub><annotation encoding="application/x-tex">\theta_T</annotation></semantics></math>
. Marginalizing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>E</mi></msub><annotation encoding="application/x-tex">P_E</annotation></semantics></math>
out of the binomial likelihood, it is well known that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
follows a beta-binomial distribution,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>∼</mo><mtext mathvariant="normal">Beta-Binomial</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo>,</mo><mi>a</mi><mo>+</mo><mi>x</mi><mo>,</mo><mi>b</mi><mo>+</mo><mi>n</mi><mo>−</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y \sim \text{Beta-Binomial}(m, a+ x,b +n - x)</annotation></semantics></math>.
When
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">Y = i</annotation></semantics></math>,
the posterior distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>E</mi></msub><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>=</mo><mi>x</mi><mo>,</mo><mi>Y</mi><mo>=</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_E\,\vert\,(X = x, Y = i)</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>+</mo><mi>x</mi><mo>+</mo><mi>i</mi><mo>,</mo><mi>b</mi><mo>+</mo><msub><mi>N</mi><mo>max</mo></msub><mo>−</mo><mi>x</mi><mo>−</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(a+x+i, b+N_{\max}-x-i)</annotation></semantics></math>.
The predictive probability (PP) of trial success can then be calculated
as follows. Letting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>i</mi></msub><mo>=</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mi>p</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo>,</mo><mi>Y</mi><mo>=</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">B_i = \mathbb{P}(P_E &gt; p \,\vert\,x, Y = i)</annotation></semantics></math>
and the indicator function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>i</mi></msub><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>B</mi><mi>i</mi></msub><mo>&gt;</mo><msub><mi>θ</mi><mi>T</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I_i = I(B_i &gt; \theta_T )</annotation></semantics></math>,
we have
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>P</mi><mi>P</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mi>p</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo>,</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>θ</mi><mi>T</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>∫</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mi>p</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo>,</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>θ</mi><mi>T</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mi>d</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>m</mi></munderover><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>i</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mi>p</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo>,</mo><mi>Y</mi><mo>=</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>θ</mi><mi>T</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>m</mi></munderover><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>i</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>B</mi><mi>i</mi></msub><mo>&gt;</mo><msub><mi>θ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>m</mi></munderover><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mi>i</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><msub><mi>I</mi><mi>i</mi></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
PP &amp;= \mathbb{E}(I[\mathbb{P}(P_E&gt;p\,\vert\,x,Y)&gt;\theta_T]\,\vert\,x)\\
&amp;=\int I[\mathbb{P}(P_E&gt;p\,\vert\,x,Y)&gt;\theta_T]dP(Y\,\vert\,x)\\
&amp;=\sum_{i=0}^m\mathbb{P}(Y=i\,\vert\,x)\times I[\mathbb{P}(P_E&gt;p\,\vert\,x,Y=i)&gt;\theta_T]\\
&amp;=\sum_{i=0}^m\mathbb{P}(Y=i\,\vert\,x)\times I(B_i&gt;\theta_t)\\
&amp;=\sum_{i=0}^m \mathbb{P}(Y=i\,\vert\,x)\times I_i
\end{align*}</annotation></semantics></math></p>
<p>The quantity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mi>i</mi></msub><annotation encoding="application/x-tex">B_i</annotation></semantics></math>
is the probability that the response rate is larger than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
responses in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
patients in the current data and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
responses in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
future patients. Comparing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>B</mi><mi>i</mi></msub><annotation encoding="application/x-tex">B_i</annotation></semantics></math>
to a threshold value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>T</mi></msub><annotation encoding="application/x-tex">\theta_T</annotation></semantics></math>
yields an indicator
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>I</mi><mi>i</mi></msub><annotation encoding="application/x-tex">I_i</annotation></semantics></math>
for considering the treatment efficacious at the end of the trial given
the current data and the potential outcome of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">Y = i</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="basic-pred-prob-design">Basic predictive probability design<a class="anchor" aria-label="anchor" href="#basic-pred-prob-design"></a>
</h4>
<p>The weighted sum of indicators
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>I</mi><mi>i</mi></msub><annotation encoding="application/x-tex">I_i</annotation></semantics></math>
yields the predictive probability of concluding a positive result by the
end of the trial based on the cumulative information in the current
stage. A high PP means that the treatment is likely to be efficacious by
the end of the study, given the current data, whereas a low PP suggests
that the treatment may not have sufficient activity. Therefore, PP can
be used to determine whether the trial should be stopped early due to
efficacy/futility or continued because the current data are not yet
conclusive. We define a rule by introducing two thresholds on PP. The
decision rule can be constructed as follows:</p>
<p><strong>Algorithm</strong> (Basic PP design)</p>
<ul>
<li>
<strong>Step 1</strong>: If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mo>&lt;</mo><msub><mi>ϕ</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">PP &lt; \phi_L</annotation></semantics></math>,
stop the trial and reject the alternative hypothesis;</li>
<li>
<strong>Step 2</strong>: If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mo>&gt;</mo><msub><mi>ϕ</mi><mi>U</mi></msub></mrow><annotation encoding="application/x-tex">PP &gt; \phi_U</annotation></semantics></math>,
stop the trial and reject the null hypothesis;</li>
<li>
<strong>Step 3</strong>: Otherwise continue to the next stage until
reaching
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mo>max</mo></msub><annotation encoding="application/x-tex">N_{\max}</annotation></semantics></math>
patients.</li>
</ul>
<p>Typically, we choose
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϕ</mi><mi>L</mi></msub><annotation encoding="application/x-tex">\phi_L</annotation></semantics></math>
as a small positive number and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϕ</mi><mi>U</mi></msub><annotation encoding="application/x-tex">\phi_U</annotation></semantics></math>
as a large positive number, both between 0 and 1 (inclusive). Note that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>L</mi></msub><mo>&lt;</mo><msub><mi>ϕ</mi><mi>U</mi></msub></mrow><annotation encoding="application/x-tex">\phi_L &lt; \phi_U</annotation></semantics></math>
and hence the order of steps 1, 2 and 3 is not relevant.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mo>&lt;</mo><msub><mi>ϕ</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">PP &lt; \phi_L</annotation></semantics></math>
indicates that it is unlikely the response rate will be larger than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
at the end of the trial given the current information. When this
happens, we may as well stop the trial and reject the alternative
hypothesis at that point. On the other hand, when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mo>&gt;</mo><msub><mi>ϕ</mi><mi>U</mi></msub></mrow><annotation encoding="application/x-tex">PP &gt; \phi_U</annotation></semantics></math>,
the current data suggest that, if the same trend continues, we will have
a high probability of concluding that the treatment is efficacious at
the end of the study. This result, then, provides evidence to stop the
trial early due to efficacy. By choosing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>L</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\phi_L &gt; 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>U</mi></msub><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\phi_U &lt; 1</annotation></semantics></math>,
the trial can terminate early due to either futility or efficacy. When
the trial reaches to the maximal number of subjects, the predictive
probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mi>p</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>θ</mi><mi>T</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">PP=I[\mathbb{P}(P_E&gt;p\,\vert\,x)&gt;\theta_T ]</annotation></semantics></math>.
Because
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mi>p</mi><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{P}(P_E&gt;p\,\vert\,x)</annotation></semantics></math>
is a constant,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">PP</annotation></semantics></math>
will equal to either 0 or 1 and hence there will always be a Go or no Go
decision made at the final analysis, i.e no “gray zone” exists.</p>
</div>
<div class="section level4">
<h4 id="advanced-predictive-probability-design">Advanced predictive probability design<a class="anchor" aria-label="anchor" href="#advanced-predictive-probability-design"></a>
</h4>
<p>Since usually in phase 1b trials, the response rate endpoint is a
surrogate for early determination of meaningful clinical benefits, a
“gray zone” at final analyses for further evaluations may be desired in
practice. To plan such a design, an advanced predictive probability
approach has been included in the latest version of the R-package.</p>
<p>A major difference between this and the previous approach is that, in
addition to the hypothesis for Go decision,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>P</mi><mi>E</mi></msub><mo>≤</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">H_0: P_E \leq p</annotation></semantics></math>
versus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>A</mi></msub><mo>:</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">H_A: P_E &gt; p</annotation></semantics></math>,
a separate hypothesis testing rule for no Go/futility decisions,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>P</mi><mi>E</mi></msub><mo>≥</mo><msub><mi>p</mi><mi>F</mi></msub></mrow><annotation encoding="application/x-tex">H_0: P_E \geq p_F</annotation></semantics></math>
versus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>A</mi></msub><mo>:</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&lt;</mo><msub><mi>p</mi><mi>F</mi></msub></mrow><annotation encoding="application/x-tex">H_A: P_E &lt; p_F</annotation></semantics></math>
is utilized (Note that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>F</mi></msub><mo>&lt;</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">p_F &lt; p</annotation></semantics></math>
is required).</p>
<p>Hence, at the final analysis: - The design is to declare efficacy if
the posterior probability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">P_E &gt; p</annotation></semantics></math>
is greater than a threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>T</mi></msub><annotation encoding="application/x-tex">\theta_T</annotation></semantics></math>
(event A) - The design is to declare futility if the posterior
probability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>E</mi></msub><mo>&lt;</mo><msub><mi>P</mi><mi>F</mi></msub></mrow><annotation encoding="application/x-tex">P_E &lt; P_F</annotation></semantics></math>
is greater than a threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>F</mi></msub><annotation encoding="application/x-tex">\theta_{F}</annotation></semantics></math>
(event B)</p>
<p>Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>T</mi></msub><annotation encoding="application/x-tex">\theta_T</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>F</mi></msub><annotation encoding="application/x-tex">\theta_{F}</annotation></semantics></math>
range from 0 to 1.</p>
<p>Thus the decision rule for interim and final analyses can be
conducted as a mixture of two basic PP designs:</p>
<p><strong>Algorithm</strong> (Advanced PP design). - <strong>Step
1</strong>: If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">event A</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>ϕ</mi><mi>U</mi></msub></mrow><annotation encoding="application/x-tex">PP(\text{event A})&gt; \phi_U</annotation></semantics></math>,
stop the trial and declare efficacy; - <strong>Step 2</strong>: If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">event B</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>ϕ</mi><mi>F</mi></msub></mrow><annotation encoding="application/x-tex">PP(\text{event B})&gt; \phi_F</annotation></semantics></math>,
stop the trial and declare futility; - <strong>Step 3</strong>:
Otherwise continue to the next stage until reaching
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mo>max</mo></msub><annotation encoding="application/x-tex">N_{\max}</annotation></semantics></math>
patients.</p>
<p>Note that here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϕ</mi><mi>U</mi></msub><annotation encoding="application/x-tex">\phi_U</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϕ</mi><mi>F</mi></msub><annotation encoding="application/x-tex">\phi_F</annotation></semantics></math>
are typically both probabilities above 0.5. Hence
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">event A</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>ϕ</mi><mi>U</mi></msub></mrow><annotation encoding="application/x-tex">PP(\text{event A})&gt;\phi_U</annotation></semantics></math>
indicates it is very likely that the treatment is efficacious at the end
of the study if the same trend of current data continues. And
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">event B</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>ϕ</mi><mi>F</mi></msub></mrow><annotation encoding="application/x-tex">PP(\text{event B})&gt;\phi_F</annotation></semantics></math>
indicates that there is a high likelihood that the treatment will be
declared as inefficacious given the current information.</p>
<p>In fact, the predictive probability for futility can be written in
the format of the predictive probability for efficacy:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>P</mi><mi>P</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&lt;</mo><msub><mi>p</mi><mi>F</mi></msub><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo>,</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>θ</mi><mi>F</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>≥</mo><msub><mi>p</mi><mi>F</mi></msub><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo>,</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><mn>1</mn><mo>−</mo><msub><mi>θ</mi><mi>F</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mn>1</mn><mo>−</mo><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>≥</mo><msub><mi>p</mi><mi>F</mi></msub><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo>,</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mn>1</mn><mo>−</mo><msub><mi>θ</mi><mi>F</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
PP &amp;= \mathbb{E}(I[\mathbb{P}(P_E&lt;p_F\,\vert\,x,Y)&gt;\theta_{F}]\,\vert\,x)\\
&amp;= \mathbb{E}(I[\mathbb{P}(P_E \geq p_F\,\vert\,x,Y)&lt; 1 - \theta_{F}]\,\vert\,x)\\
&amp;=1-\mathbb{E}(I[\mathbb{P}(P_E \geq p_F\,\vert\,x,Y)&gt;1-\theta_{F}]\,\vert\,x)
\end{align*}</annotation></semantics></math></p>
<p>Thus by using this trick, the <code><a href="../reference/predprob.html">predprob()</a></code> or
<code><a href="../reference/predprobDist.html">predprobDist()</a></code> functions can be used to calculate the
predictive probabilities for futility. The separate section describes
this <a href="#PredProb-advanced">advanced predictive probability
design</a>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="examples">Examples using <code>phase1b</code><a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>The following subsections take the reader through a series of
synthetic examples based on a specific Oncology indication. The
accompanying (highly modifiable) <code>R</code> code is intended to help
familiarize the user with the <code>phase1b</code> R-package, which can
of course be applied to any indication.</p>
<div class="section level3">
<h3 id="example-scenario">Scenario for the example<a class="anchor" aria-label="anchor" href="#example-scenario"></a>
</h3>
<p>Assume the following hypothetical scenario. The current standard of
care (SOC) for the cancer XYZ is the chemotherapy regimen known as ABC.
In this example, we explore the potential advantage of a phase 1b
combination trial in the XYZ indication by combining ABC with a new
molecule, say D, as compared to the current SOC. For the combination
example considered, the unmet need is a progression free survival (PFS)
hazard ratio (HR) of 0.64. The control comes from a 150 patient subset
of a previous study using ABC in XYZ, and our Phase 1b endpoint is
PET-CR as it has been hypothesized that a meaningful improvement in
PET-CR may predict a meaningful improvement in PFS.</p>
</div>
<div class="section level3">
<h3 id="posterior-probability-design">Posterior Probability Design<a class="anchor" aria-label="anchor" href="#posterior-probability-design"></a>
</h3>
<div class="section level4">
<h4 id="posterior-probability-calculations">Posterior Probability Calculations<a class="anchor" aria-label="anchor" href="#posterior-probability-calculations"></a>
</h4>
<p>Under the Bayesian approach, we quantify all of our a priori
uncertainty about the PET-CR rates via their prior distributions. For
sake of example, we use a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>5.75</mn><mo>,</mo><mn>4.25</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(5.75,4.25)</annotation></semantics></math>
prior to describe our uncertainty about the unknown PET-CR rate for the
novel combo (ABC + D), however in practice, this prior would be chosen
based on historical data and/or eliciting expert knowledge and opinion.
Likewise, for the historical control (ABC), we set the prior
distribution equal to the posterior distribution which is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">Beta(75,75)</mtext><annotation encoding="application/x-tex">\text{Beta(75,75)}</annotation></semantics></math>
distribution that is centered exactly at the observed PET-CR rate in the
historical control.</p>
<p>The following lines of code @ref(fig:ex1-prior) allow the user to be
able to visualize our prior uncertainty about the PET-CR rates between
the historical control and the novel combination.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.001</span><span class="op">)</span></span>
<span><span class="va">dens.control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="va">xx</span>, <span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span> <span class="co"># Posterior of the control</span></span>
<span><span class="va">dens.prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="va">xx</span>, <span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span> <span class="co"># Prior of the Phase 1b trial</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">dens.control</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"darkgrey"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"PET-CR Rate"</span>, ylab <span class="op">=</span> <span class="st">"Density"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Prior Distributions"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">dens.prior</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"deepskyblue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0%"</span>, <span class="st">"25%"</span>, <span class="st">"50%"</span>, <span class="st">"75%"</span>, <span class="st">"100%"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hist. Control"</span>, <span class="st">"Novel Combo"</span><span class="op">)</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightgrey"</span>, <span class="st">"deepskyblue"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/ex1-prior-1.png" alt="The prior distributions for the historical control and novel combination treatment group. A $ ext{Beta}(75,75)$ prior is used for the historical control, and a $ ext{Beta}(5.75,4.25)$ prior is used for the novel combination treatment group" width="700"><p class="caption">
The prior distributions for the historical control and novel combination
treatment group. A $ ext{Beta}(75,75)$ prior is used for the historical
control, and a $ ext{Beta}(5.75,4.25)$ prior is used for the novel
combination treatment group
</p>
</div>
<p>In the resulting Figure~@ref(fig:ex1-prior) we see that the density
of the prior for the historical control is greatly concentrated in the
area of the observed PET-CR rate while the prior for PET-CR rate of the
novel combination is more dispersed across many potential PET-CR rates
indicating a higher level of apriori uncertainty. Now, using the <a href="#methods">posterior distribution</a>, we can update our
uncertainty about the PET-CR rate for the novel combination via
calculating the posterior distribution. Recall that our prior
distribution for the novel combination PET-CR rate is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>5.75</mn><mo>,</mo><mn>4.25</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(5.75,4.25)</annotation></semantics></math>,
and the data likelihood, conditional on the PET-CR rate, follows a
binomial likelihood and thus, due to conjugacy, the posterior
distribution will also follow a Beta distribution with updated
parameters based on the observed data. For example, if after running the
trial for the novel combination we were to observe 55 responders out of
a total of 80 patients, i.e., a PET-CR rate of 68.75%, then our
posterior updating based on the prior distribution and observed data
would lead to a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>60.75</mn><mo>,</mo><mn>29.25</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(60.75,29.25)</annotation></semantics></math>
posterior distribution for the novel combination PET-CR rate.</p>
<p>Alternatively, we could use the R-package function
<code><a href="../reference/plotBeta.html">plotBeta()</a></code> to achieve the same result, see
Figure~@ref(fig:ex1-prior_plotBeta1) and
Figure~@ref(fig:ex1-prior_plotBeta2).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBeta.html">plotBeta</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">75</span>, beta <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/ex1_prior_plotBeta-1.png" alt="The prior distributions for the historical control and novel combination treatment group. A $    ext{Beta}(75,75)$ prior is used for the historical control, and a $ ext{Beta}(5.75,4.25)$ prior is used for the novel combination treatment group." width="700"><p class="caption">
The prior distributions for the historical control and novel combination
treatment group. A $ ext{Beta}(75,75)$ prior is used for the historical
control, and a $ ext{Beta}(5.75,4.25)$ prior is used for the novel
combination treatment group.
</p>
</div>
<p>For the Novel combination, the following posterior has been
updated.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBeta.html">plotBeta</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">5.75</span>, beta <span class="op">=</span> <span class="fl">4.25</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/ex1_prior_plotBeta2-1.png" alt="The prior distributions for the historical control and novel combination treatment group. A $   ext{Beta}(75,75)$ prior is used for the historical control, and a $ ext{Beta}(5.75,4.25)$ prior is used for the novel combination treatment group." width="700"><p class="caption">
The prior distributions for the historical control and novel combination
treatment group. A $ ext{Beta}(75,75)$ prior is used for the historical
control, and a $ ext{Beta}(5.75,4.25)$ prior is used for the novel
combination treatment group.
</p>
</div>
<p>The following code allows the reader to visualize the posterior
distribution for the PET-CR rate against the posterior distribution of
the historical control.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.001</span><span class="op">)</span></span>
<span><span class="va">dens.control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="va">xx</span>, <span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span></span>
<span><span class="va">dens.post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="va">xx</span>, <span class="fl">5.75</span> <span class="op">+</span> <span class="fl">55</span>, <span class="fl">4.25</span> <span class="op">+</span> <span class="fl">80</span> <span class="op">-</span> <span class="fl">55</span><span class="op">)</span> <span class="co"># 80 is sample size of 1b trial and 55 is the number of responders</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">dens.control</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"darkgrey"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"PET-CR Rate"</span>, ylab <span class="op">=</span> <span class="st">"Density"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Posterior Distributions"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">dens.post</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"deepskyblue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0%"</span>, <span class="st">"25%"</span>, <span class="st">"50%"</span>, <span class="st">"75%"</span>, <span class="st">"100%"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hist. Control"</span>, <span class="st">"Novel Combo"</span><span class="op">)</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkgrey"</span>, <span class="st">"deepskyblue"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/ex1-posterior-1.png" width="4in"></p>
<p>In the resulting Figure~@ref(fig:ex1-posterior) we see that the
posterior distribution is much more peaked than the prior distribution
in Figure~@ref(fig:ex1-prior) reflecting the fact that once we have
observed data, our uncertainty about the true PET-CR rate in the novel
combination should diminish. Once the posterior distribution is
obtained, the user can use the <code><a href="../reference/postprob.html">postprob()</a></code> command to make
posterior probability calculations about the PET-CR rate for either the
novel combination or historical control. For example, the user could
calculate the probability that the PET-CR rate is greater than 60%,
i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mi>E</mi></msub><mo>&gt;</mo><mn>0.6</mn><mspace width="0.167em"></mspace><mo stretchy="false" form="postfix">|</mo><mspace width="0.167em"></mspace><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{P}(P_E &gt; 0.6 \,\vert\,x)</annotation></semantics></math>,
by issuing the following command:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/postprob.html">postprob</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">55</span>, n <span class="op">=</span> <span class="fl">80</span>, p <span class="op">=</span> <span class="fl">0.6</span>, parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9322701</span></span></code></pre></div>
<p>Here the result indicates that there is a roughly 93% chance that the
PET-CR rate for the novel combination is above 60%.</p>
</div>
<div class="section level4">
<h4 id="operating-characteristics">Operating Characteristics<a class="anchor" aria-label="anchor" href="#operating-characteristics"></a>
</h4>
<p>Similarly, the user may be interested in calculating the frequentist
probability that a clinical trial is stopped for efficacy or futility,
conditional on true values of the response rate. These calculations need
to take into account in particular interim looks at the data before
reaching the final sample size of the trial. Hence, the calculations are
difficult to perform in a closed manner. However, we can resort to Monte
Carlo calculation, which means that we simulate a very large number of
trials and estimate with high precision the frequentist probabilities of
interest. These are the key operating characteristics of the trial
design.</p>
<p>For example, we may be interested in a conducting a single arm Phase
1b trial where interim analyses will be planned once we have accrued 10,
20 and 30 patients (30 being the maximum number of patients we will
accrue). We declare efficacy early, at the interim looks, if the
posterior probability that the observed response rate,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>E</mi></msub><annotation encoding="application/x-tex">p_E</annotation></semantics></math>,
is greater than a predefined efficacy threshold,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub><mo>=</mo><mn>30</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">p_1 = 30\%</annotation></semantics></math>,
exceeds some upper probability threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>U</mi></msub><mo>=</mo><mn>80</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">t_U=80\%</annotation></semantics></math>,
i.e.,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>E</mi></msub><mo>&gt;</mo><msub><mi>p</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>t</mi><mi>U</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathbb{P}(p_E&gt;p_1)&gt;t_U.
</annotation></semantics></math></p>
<p>Likewise, we declare futility early if the the posterior probability
that the observed response rate,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>E</mi></msub><annotation encoding="application/x-tex">p_E</annotation></semantics></math>,
is less than some predefined efficacy threshold,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub><mo>=</mo><mn>20</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">p_0=20\%</annotation></semantics></math>,
is smaller than some lower probability threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>L</mi></msub><mo>=</mo><mn>60</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">t_L=60\%</annotation></semantics></math>,
i.e.,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>E</mi></msub><mo>&lt;</mo><msub><mi>p</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mi>t</mi><mi>L</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathbb{P}(p_E&lt;p_0)&lt;t_L.
</annotation></semantics></math> Following the usual Bayesian framework,
we need to specify a prior distribution for the unknown response rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>E</mi></msub><annotation encoding="application/x-tex">p_E</annotation></semantics></math>
and so we place a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(1,1)</annotation></semantics></math>
prior for our unknown response rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>E</mi></msub><annotation encoding="application/x-tex">p_E</annotation></semantics></math>.</p>
<p>Furthermore, we may wish to examine the operating characteristics of
this design in the scenario that the true response rate,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>,
is equal to 40% – so in a scenario where we would like to declare
efficacy. In order to calculate the operating characteristics using
10,000 (parameter <code>ns</code>) simulated trials, we issue the
following command:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ocPostprob.html">ocPostprob</a></span><span class="op">(</span></span>
<span>  nnE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>  truep <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  p0 <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  p1 <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  tL <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  tU <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  sim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  wiggle <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nnF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in ocPostprob(nnE = c(10, 20, 30), truep = 0.4, p0 = 0.2, p1 = 0.3, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">oc</span></span>
<span><span class="co">#&gt;   ExpectedN PrStopEarly PrEarlyEff PrEarlyFut PrEfficacy PrFutility PrGrayZone</span></span>
<span><span class="co">#&gt; 1      19.8        0.64       0.57       0.07       0.71       0.07       0.22</span></span></code></pre></div>
<p>Here the object <code>results</code> is a list, which stores the
operating characteristics of running the simulations inside the element
<code>oc</code>. From our simulations we have that the expected number
of patients in the trial, after stopping for either efficacy or
futility, is 19. Furthermore, 67% of the simulated trials stopped early
during the interim analyses. Of these 10,000 trials, 61.95% declared
early efficacy while 5.27% of them were stopped early for futility.
However, combining the trials that did and did not stop early, 75.64% of
have declared efficacy while 5.4% of have declared futility. These
percentages do not sum up to 100% because of the 10,000 simulated trials
18.62% would not have been declared as efficacious or futile by the time
the maximum sample size of 30 patients had been reached – i.e., they
fell into the grayzone.</p>
</div>
<div class="section level4">
<h4 id="difference-in-posterior-distributions">Difference in Posterior Distributions<a class="anchor" aria-label="anchor" href="#difference-in-posterior-distributions"></a>
</h4>
<p>The user may be interested in showing that the novel combination is
superior to the historical control when comparing PET-CR rates. In order
to make such a comparison, we can make use of the
<code><a href="../reference/dbetadiff.html">dbetadiff()</a></code> function to compute the distribution of the
difference in PET-CR rates between the novel combination and the
historical control. This is a relatively simple task and, from the
Bayesian point of view, this is simply the distribution of the
difference in posterior distributions, which is equivalent to the
distribution of the difference in two independent Beta random variables.
The interested user is reminded to read the <a href="#methods">methods
section</a> for the detailed analytical calculations of this
distribution.</p>
<p>Returning to the previous example, recall that we placed a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>5.75</mn><mo>,</mo><mn>4.25</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(5.75,4.25)</annotation></semantics></math>
prior on the PET-CR rate for the novel combination, and observed 55
responders out of 80 patients in the novel combination, as well as 75
responders out of 150 patients in the historical control. These observed
PET-CR rates led to a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>60.75</mn><mo>,</mo><mn>29.25</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(60.75,29.25)</annotation></semantics></math>
and a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>75</mn><mo>,</mo><mn>75</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(75,75)</annotation></semantics></math>
posterior distribution for the novel combination and historical control
PET-CR rates, respectively. Based on our learning endpoint, we may
believe that seeing a difference in PET-CR rates greater than some
threshold, say for example 15%, may indicate a meaningful improvement in
PFS for the novel combination over the historical control. Defining the
difference in PET-CR rates to be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Δ</mi><mo>=</mo><mtext mathvariant="normal">(Combo Response)-(Control Response)</mtext></mrow><annotation encoding="application/x-tex">\Delta=\text{(Combo Response)-(Control Response)}</annotation></semantics></math>,
we may ultimately be interested in making probabilistic calculations
such as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Δ</mi><mo>&gt;</mo><mn>15</mn><mi>%</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{P}(\Delta&gt;15\%)</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Δ</mi><mo>≤</mo><mn>5</mn><mi>%</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{P}(\Delta\leq 5\%)</annotation></semantics></math>
because these calculations may be informative for <code>Go" and</code>No
Go” decisions. For example, if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Δ</mi><mo>&gt;</mo><mn>15</mn><mi>%</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{P}(\Delta&gt;15\%)</annotation></semantics></math>
or the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Δ</mi><mo>≤</mo><mn>5</mn><mi>%</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{P}(\Delta\leq 5\%)</annotation></semantics></math>
is “large” then we may decide to declare a go or no go, respectively.
Consider a probability exceeding 60% to be large, then following the
same example as above, we could evaluate the following go/no go criteria
based on the distribution of the difference in PET-CR with the code for
@ref(fig:ex1:betadiff1).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span></span>
<span><span class="va">parY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span> <span class="op">+</span> <span class="fl">55</span>, <span class="fl">4.25</span> <span class="op">+</span> <span class="fl">80</span> <span class="op">-</span> <span class="fl">55</span><span class="op">)</span></span>
<span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.001</span><span class="op">)</span></span>
<span><span class="va">dens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbetadiff.html">dbetadiff</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">parY</span>, <span class="va">parX</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x.poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span>, <span class="va">xx</span><span class="op">)</span></span>
<span><span class="va">y.poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span><span class="op">)</span>, <span class="va">dens</span><span class="op">)</span></span>
<span></span>
<span><span class="va">idx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x.poly</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">idx2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x.poly</span> <span class="op">&gt;</span> <span class="fl">0.15</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">dens</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"PET-CR Comparison"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"(Combo Response) - (Control Response)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">""</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-50%"</span>, <span class="st">"-25%"</span>, <span class="st">"+0%"</span>, <span class="st">"+25%"</span>, <span class="st">"+50%"</span>, <span class="st">"+75%"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="va">x.poly</span><span class="op">[</span><span class="va">idx1</span><span class="op">]</span>, <span class="va">y.poly</span><span class="op">[</span><span class="va">idx1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="va">x.poly</span><span class="op">[</span><span class="va">idx2</span><span class="op">]</span>, <span class="va">y.poly</span><span class="op">[</span><span class="va">idx2</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prob. of No Go"</span>, <span class="st">"Prob. of Go"</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">2</span>, <span class="fl">.22</span>, <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">2.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Prob"</span> <span class="op">*</span> <span class="op">(</span><span class="va">Delta</span> <span class="op">&gt;</span> <span class="op">+</span><span class="fl">15</span> <span class="op">*</span> <span class="st">"%"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.25</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">.2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.25</span>, <span class="fl">2.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Prob"</span> <span class="op">*</span> <span class="op">(</span><span class="va">Delta</span> <span class="op">&lt;</span> <span class="op">+</span><span class="fl">5</span> <span class="op">*</span> <span class="st">"%"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/ex1:betadiff1-1.png" width="4in"></p>
<p>Alternatively, we could use the R-package function
<code><a href="../reference/myPlotDiff.html">myPlotDiff()</a></code> to achieve the the same result in far fewer
lines of code, see Figure~@ref(fig:ex1:betadiff1:myPlotDiff)).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/myPlotDiff.html">myPlotDiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span> <span class="op">+</span> <span class="fl">55</span>, <span class="fl">4.25</span> <span class="op">+</span> <span class="fl">80</span> <span class="op">-</span> <span class="fl">55</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span>, <span class="fl">1</span>, <span class="fl">0</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"(Combo Response) - (Control Response)"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prob. of No Go"</span>, <span class="st">"Prob. of Go"</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">2</span>, <span class="fl">.22</span>, <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">2.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Prob"</span> <span class="op">*</span> <span class="op">(</span><span class="va">Delta</span> <span class="op">&gt;</span> <span class="op">+</span><span class="fl">15</span> <span class="op">*</span> <span class="st">"%"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.25</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">.2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.25</span>, <span class="fl">2.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Prob"</span> <span class="op">*</span> <span class="op">(</span><span class="va">Delta</span> <span class="op">&lt;</span> <span class="op">+</span><span class="fl">5</span> <span class="op">*</span> <span class="st">"%"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/ex1:betadiff1:myPlotDiff-1.png" alt="The distribution of the difference in PET-CR rates amongst the novel combination group and the historical control. Here, we see that the probability of a go decision (green) is much more likely than the probability of a no go decision (red)." width="700"><p class="caption">
The distribution of the difference in PET-CR rates amongst the novel
combination group and the historical control. Here, we see that the
probability of a go decision (green) is much more likely than the
probability of a no go decision (red).
</p>
</div>
<p>In Figure @ref(fig:ex1:betadiff1) we see that the probability of a go
decision (shaded green) is much larger than the probability of a no go
decision (shaded red). In fact, we can calculate those exact probability
values of a go/no go decision with the following commands:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pbetadiff.html">pbetadiff</a></span><span class="op">(</span><span class="fl">0.05</span>, parY <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span> <span class="op">+</span> <span class="fl">55</span>, <span class="fl">4.25</span> <span class="op">+</span> <span class="fl">80</span> <span class="op">-</span> <span class="fl">55</span><span class="op">)</span>, parX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.02684542</span></span>
<span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="../reference/pbetadiff.html">pbetadiff</a></span><span class="op">(</span><span class="fl">0.15</span>, parY <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span> <span class="op">+</span> <span class="fl">55</span>, <span class="fl">4.25</span> <span class="op">+</span> <span class="fl">80</span> <span class="op">-</span> <span class="fl">55</span><span class="op">)</span>, parX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6558079</span></span></code></pre></div>
<p>From our “large” threshold of exceeding 60%, we see that we would
declare a go decision in this situation since the probability that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Δ</mi><annotation encoding="application/x-tex">\Delta</annotation></semantics></math>
exceeds 15% is equal to 66% which is larger than our 60% threshold.</p>
<p>Alternatively, this posterior probability can be calculated using the
<code><a href="../reference/postprobDist.html">postprobDist()</a></code> function, as follows:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="../reference/postprobDist.html">postprobDist</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">55</span>, n <span class="op">=</span> <span class="fl">80</span>, delta <span class="op">=</span> <span class="fl">0.05</span>, parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span>, parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.02684542</span></span>
<span><span class="fu"><a href="../reference/postprobDist.html">postprobDist</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">55</span>, n <span class="op">=</span> <span class="fl">80</span>, delta <span class="op">=</span> <span class="fl">0.15</span>, parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span>, parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6558079</span></span></code></pre></div>
<p>This function works in a very similar way as <code>postprob</code>
explained <a href="#postdist">here</a>. The only difference is that
there is now the beta prior distribution on the comparator response
rate.</p>
<p>On the other hand, had we observed a hypothetical situation where the
number of responders was much lower, say 42 responders out of 80
patients, than we could re-run the same analysis to see how this would
impact our go/no go decisions. The following code re-runs the previous
example but with a much lower response rate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>42</mn><mi>/</mi><mn>80</mn><mo>=</mo><mn>52.5</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">42/80=52.5\%</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span></span>
<span><span class="va">parY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span> <span class="op">+</span> <span class="fl">42</span>, <span class="fl">4.25</span> <span class="op">+</span> <span class="fl">80</span> <span class="op">-</span> <span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.001</span><span class="op">)</span></span>
<span><span class="va">dens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbetadiff.html">dbetadiff</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">parY</span>, <span class="va">parX</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x.poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span>, <span class="va">xx</span><span class="op">)</span></span>
<span><span class="va">y.poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span><span class="op">)</span>, <span class="va">dens</span><span class="op">)</span></span>
<span></span>
<span><span class="va">idx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x.poly</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">idx2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x.poly</span> <span class="op">&gt;</span> <span class="fl">0.15</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">dens</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"PET-CR Comparison"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"(Combo Response) - (Control Response)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">""</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-50%"</span>, <span class="st">"-25%"</span>, <span class="st">"+0%"</span>, <span class="st">"+25%"</span>, <span class="st">"+50%"</span>, <span class="st">"+75%"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="va">x.poly</span><span class="op">[</span><span class="va">idx1</span><span class="op">]</span>, <span class="va">y.poly</span><span class="op">[</span><span class="va">idx1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="va">x.poly</span><span class="op">[</span><span class="va">idx2</span><span class="op">]</span>, <span class="va">y.poly</span><span class="op">[</span><span class="va">idx2</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Prob. of No Go"</span>, <span class="st">"Prob. of Go"</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="fl">.45</span>, <span class="fl">2</span>, <span class="fl">.2</span>, <span class="fl">.5</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">.45</span>, <span class="fl">2.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Prob"</span> <span class="op">*</span> <span class="op">(</span><span class="va">Delta</span> <span class="op">&gt;</span> <span class="op">+</span><span class="fl">15</span> <span class="op">*</span> <span class="st">"%"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.3</span>, <span class="fl">2</span>, <span class="op">-</span><span class="fl">.03</span>, <span class="fl">.9</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.3</span>, <span class="fl">2.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Prob"</span> <span class="op">*</span> <span class="op">(</span><span class="va">Delta</span> <span class="op">&lt;</span> <span class="op">+</span><span class="fl">5</span> <span class="op">*</span> <span class="st">"%"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/ex1:betadiff2-1.png" alt="The distribution of the difference in PET-CR rates amongst the novel combination group and the historical control. Here, we see that the probability of a go decision (green) is much less likely than the probability of a no go decision (red)." width="700"><p class="caption">
The distribution of the difference in PET-CR rates amongst the novel
combination group and the historical control. Here, we see that the
probability of a go decision (green) is much less likely than the
probability of a no go decision (red).
</p>
</div>
<p>Note now that the change in response rate also affects the posterior
distribution of the PET-CR rate for the novel combination group. Before
the posterior distribution was a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>60.75</mn><mo>,</mo><mn>29.25</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(60.75,29.25)</annotation></semantics></math>
distribution and now, due to the low observed response rate, the
posterior distribution is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>47.75</mn><mo>,</mo><mn>42.25</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(47.75,42.25)</annotation></semantics></math>.
Using this new posterior distribution, we obtain the following
distribution of the difference, Figure~@ref(fig:ex1:betadiff2), in
PET-CR rates between the two groups. We see that the probability of a no
go decision is much higher than the probability of a go decision due to
the lower response rate in the novel combination group. As before, we
can execute the following commands to calculate those exact
probabilities:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="../reference/postprobDist.html">postprobDist</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">42</span>, n <span class="op">=</span> <span class="fl">80</span>, delta <span class="op">=</span> <span class="fl">0.05</span>, parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span>, parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6142228</span></span>
<span><span class="fu"><a href="../reference/postprobDist.html">postprobDist</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">42</span>, n <span class="op">=</span> <span class="fl">80</span>, delta <span class="op">=</span> <span class="fl">0.15</span>, parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span>, parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.03532739</span></span></code></pre></div>
<p>Thus, there is a 61% chance that the novel combination results in a
less than 5% improvement in PET-CR rates relative to the historical
control, and hence a no go decision would be declared.</p>
</div>
</div>
<div class="section level3">
<h3 id="PredProb-design">Predictive Probability Design<a class="anchor" aria-label="anchor" href="#PredProb-design"></a>
</h3>
<p>This example aims to illustrate the usage of predictive probabilities
(<em>PP</em>) to conduct interim analyses as described in <a href="#basic-pred-prob-design">the basic PP design</a>. The single arm
XYZ combo trial which was discussed in the previous section is used in
this section as well. Besides, this section also includes a simulation
study to evaluate the operating characteristics of the study design.</p>
<p>Similar to the previous example, it has been hypothesized that a 15%
absolute increasement of PET-CR may predict a meaningful clinical
benefit for XYZ patients. Thus the goal of the trial is set to evaluate
the PET-CR rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><annotation encoding="application/x-tex">P_{combo}</annotation></semantics></math>
by testing the hyoithesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><mo>≤</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>+</mo><mn>15</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">H_0: P_{combo} \leq P_{control}+15\%</annotation></semantics></math>
versus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>A</mi></msub><mo>:</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><mo>&gt;</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>+</mo><mn>15</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">H_A: P_{combo} &gt; P_{control}+15\%</annotation></semantics></math>.
Thus let’s further determine that, when the sample size reaches the
maximum, the study is to declare efficacy if the posterior probability
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><mo>&gt;</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>+</mo><mn>15</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">P_{combo} &gt; P_{control}+15\%</annotation></semantics></math>
is greater than a threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>T</mi></msub><mo>=</mo><mn>0.6</mn></mrow><annotation encoding="application/x-tex">\theta_T=0.6</annotation></semantics></math>.
Otherwise, the study is to declare futility.</p>
<p>Here, it is assumed that 2 interim analyses are planed at 25 and 40
patients along with a final analysis at 80 patients to evaluate both
efficacy and futility. The study stops at interim when</p>
<ul>
<li>Efficacy stop if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mo>&gt;</mo><msub><mi>ϕ</mi><mi>U</mi></msub></mrow><annotation encoding="application/x-tex">PP&gt;\phi_U</annotation></semantics></math>
</li>
<li>Futility stop if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mo>&lt;</mo><msub><mi>ϕ</mi><mi>L</mi></msub></mrow><annotation encoding="application/x-tex">PP&lt;\phi_L</annotation></semantics></math>
</li>
</ul>
<p>where we set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>U</mi></msub><mo>=</mo><mn>0.8</mn></mrow><annotation encoding="application/x-tex">\phi_U=0.8</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>L</mi></msub><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">\phi_L=0.2</annotation></semantics></math>
for illustration.</p>
<p>Please be aware, there will be no “gray zone” in terms of decision
making at the final analysis when using the the basic <em>PP</em> design
(see details in the predictive probability section).</p>
<div class="section level4">
<h4 id="predictive-probability-calculation">Predictive Probability Calculation<a class="anchor" aria-label="anchor" href="#predictive-probability-calculation"></a>
</h4>
<p>To calculate the predictive probability when comparing two
distributions (treatment vs. SOC), the <code><a href="../reference/predprobDist.html">predprobDist()</a></code>
function can be used. In order to perform the calulation, the maximal
number of patient (80), a Beta prior of the treatment arm
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>5.75</mn><mo>,</mo><mn>4.25</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(5.75, 4.25)</annotation></semantics></math>),
a Beta posterior distribution of the SOC arm
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>75</mn><mo>,</mo><mn>75</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Beta}(75,75)</annotation></semantics></math>)
are required. Since the beta distribution is a conjugate prior to the
binomial distribution (see formula 1-8), the posterior distribution of
SOC can be directly entered to the <code>parS</code> argument.</p>
<p>For instance, if there are 18 PET-CR at the first interim analysis
(n=25), the predictive probabilities can be calculated by</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predprobDist.html">predprobDist</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">18</span>, n <span class="op">=</span> <span class="fl">25</span>, Nmax <span class="op">=</span> <span class="fl">80</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>  thetaT <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span>,</span>
<span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#&gt; $result</span></span>
<span><span class="co">#&gt; [1] 0.5755374</span></span></code></pre></div>
<p>In this case, study will continue since PP, 57.5%, does neither
exceed 80% nor fall below 20%.</p>
</div>
<div class="section level4">
<h4 id="operating-characteristics-evaluation">Operating Characteristics Evaluation<a class="anchor" aria-label="anchor" href="#operating-characteristics-evaluation"></a>
</h4>
<p>Before the Phase 1b trial starts, users may want to evaluate the
design operating characteristics at an assumed true PET-CR rate of the
combo trial. The <code><a href="../reference/ocPredprobDist.html">ocPredprobDist()</a></code> function will allow such
an evaluation under a single scenario of true response rate. The
following code assumes a true PET-CR rate of 75%. The planned interim
and final looks are at 25, 40 and 80 patients which is entered as a
vector in the <code>nnE</code> argument. <code>truep</code> is the true
PET-CR rate we assumed, and we are targeting for a <code>deltaE</code>
improvement over control (<code>deltaE</code> and <code>deltaF</code>
ranges from 0 to 1). <code>tT</code> is the threshold for the
probability to be above control + delta at the end of the trial, and
<code>phiL</code> and <code>phiU</code> are the lower and upper
thresholds on the predictive probability, respectively. Same as the
notations in the <code><a href="../reference/predprobDist.html">predprobDist()</a></code> function, <code>parE</code>
and <code>parS</code> are the place to enter beta parameters for the
prior on the treatment and control proportion, respectively.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># with 100 simulated trials, assume true PET-CR rate of the combo trial is 40%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ocPredprobDist.html">ocPredprobDist</a></span><span class="op">(</span></span>
<span>  nnE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">40</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>  truep <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  deltaE <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>  deltaF <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>  relativeDelta <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tT <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  phiL <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  phiU <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span>,</span>
<span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  weightsS <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  sim <span class="op">=</span> <span class="fl">5</span>, <span class="co"># advise to use &gt; 50000 to achieve convergence</span></span>
<span>  nnF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">40</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>  wiggle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  decision1 <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nnE = c(25, 40, 80), truep = 0.75, deltaE = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span></span>
<span><span class="va">res1</span><span class="op">$</span><span class="va">oc</span></span>
<span><span class="co">#&gt;   ExpectedN PrStopEarly PrEarlyEff PrEarlyFut PrEfficacy PrFutility PrGrayZone</span></span>
<span><span class="co">#&gt; 1        64         0.4        0.4          0          1          0          0</span></span></code></pre></div>
<p>The number of simulation is 10 in this case, just to speed up the
example. However, the user needs to increase the number to 50,000 or
higher to generate better convergence.</p>
<p>According to the simulation result, the expected sample size of the
trial is 44.4. 87% of the simulated trials declare efficacy and the rest
13% of trials declare futility. In terms of early stopping, 71% of the
simulated trials stop at interim. Among those,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>60</mn><mi>%</mi><mi>/</mi><mn>71</mn><mi>%</mi><mo>=</mo><mn>84.5</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">60\%/71\%=84.5\%</annotation></semantics></math>
trials stop for efficacy, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>11</mn><mi>%</mi><mi>/</mi><mn>71</mn><mi>%</mi><mo>=</mo><mn>15.5</mn></mrow><annotation encoding="application/x-tex">11\%/71\%=15.5</annotation></semantics></math>
trials stop for futility.</p>
<p>Usually, more than one true scenario will be evaluated. Figure
@ref(fig:ex2:summary) summerizes the operating characteristics among
different true PET-CR rate from 10% to 80%. Y axis is the percentage of
trials that return a efficacy/futility decision. When true rate is low
comparing to the response rate of control+delta, a efficacy decision is
considered as a type I error, and when true rate is relatively high
comparing to the control+delta, a futility decision is considered as a
type II error.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="co"># Used for reproducibility</span></span>
<span><span class="va">p_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Mysim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">p_par</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ocPredprobDist.html">ocPredprobDist</a></span><span class="op">(</span></span>
<span>    nnE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">40</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>    truep <span class="op">=</span> <span class="va">x</span>,</span>
<span>    delta <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>    deltaF <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>    relativeDelta <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    tT <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>    phiL <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    phiU <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span>,</span>
<span>    parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span>,</span>
<span>    weights <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    weightsS <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    sim <span class="op">=</span> <span class="fl">10</span>, <span class="co"># advise to use &gt; 50000 to achieve convergence</span></span>
<span>    nnF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">40</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>    wiggle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    decision1 <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">oc</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nnE = c(25, 40, 80), truep = x, delta = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nnE = c(25, 40, 80), truep = x, delta = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nnE = c(25, 40, 80), truep = x, delta = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nnE = c(25, 40, 80), truep = x, delta = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nnE = c(25, 40, 80), truep = x, delta = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nnE = c(25, 40, 80), truep = x, delta = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nnE = c(25, 40, 80), truep = x, delta = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nnE = c(25, 40, 80), truep = x, delta = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nnE = c(25, 40, 80), truep = x, delta = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span></span>
<span><span class="va">peffbp</span> <span class="op">&lt;-</span> <span class="va">Mysim</span><span class="op">[</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="va">pfutbp</span> <span class="op">&lt;-</span> <span class="va">Mysim</span><span class="op">[</span><span class="fl">6</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"n"</span>, xlab <span class="op">=</span> <span class="st">"True Rate"</span>, ylab <span class="op">=</span> <span class="st">"Pr(Decision)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">p_par</span>, <span class="va">peffbp</span>, lwd <span class="op">=</span> <span class="fl">5</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">p_par</span>, <span class="va">pfutbp</span>, lwd <span class="op">=</span> <span class="fl">5</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.6</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">5</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"red"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">.75</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Efficacy Decision"</span>, <span class="st">"Futility Decision"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/ex2:summary-1.png" alt="A summary plot of Go/No Go decisions over different true rates" width="700"><p class="caption">
A summary plot of Go/No Go decisions over different true rates
</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="PredProb-advanced">Advanced predictive probability design<a class="anchor" aria-label="anchor" href="#PredProb-advanced"></a>
</h3>
<p>As an extension of the <a href="#PredProb">basic example</a>, this
example shows a way to use predictive probabilities (<em>PP</em>) to
conduct interim analyses allowing gray zones at the final analyses,
i.e. trial results where neither efficacy nor futility decisions are
made are possible (refering to the advance <em>PP</em> design in the
predictive probability section). Such a final analysis design was used
in the XYZ example, of which the basic <em>PP</em> design used in the
example <a href="#PredProb">earlier</a> is not suitable for the related
interim analyses, while the advanced predictive probability design
should be used.</p>
<p>An advantage of such a design is that it allows an option of further
evaluation on additional clinical endpoints or PD markers when the
decision falls into the “gray zone”. Moreover, a separate delta can be
specified for the futility decision to represent a “pool clinical
improvement”, which makes it a more flexible decision rule.</p>
<p>The single arm XYZ combo trial which was discussed in the previous
examples is used here as well. A simulation study to evaluate the
operating characteristics of study design is carried out.</p>
<p>Similar to the first example, the goal is to evaluate the PET-CR rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><annotation encoding="application/x-tex">P_{combo}</annotation></semantics></math>
by testing the hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><mo>≤</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>+</mo><mn>15</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">H_0: P_{combo} \leq P_{control}+15\%</annotation></semantics></math>
versus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>A</mi></msub><mo>:</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><mo>&gt;</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>+</mo><mn>15</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">H_A: P_{combo} &gt; P_{control}+15\%</annotation></semantics></math>
for efficacy. And the futility checks are conducted by testing the
hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><mo>≥</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>+</mo><mn>5</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">H_0: P_{combo} \geq P_{control}+5\%</annotation></semantics></math>
versus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>A</mi></msub><mo>:</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><mo>&lt;</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>+</mo><mn>5</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">H_A: P_{combo} &lt; P_{control}+5\%</annotation></semantics></math>.
Here, we assume that 2 interim analyses are planed at 25 and 40 patients
along with a final analysis to evaluate both efficacy and futility.</p>
<p>Thus at the final analysis:</p>
<ul>
<li>The design is to declare efficacy if the posterior probability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><mo>&gt;</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>+</mo><mn>15</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">P_{combo} &gt; P_{control}+15\%</annotation></semantics></math>
is greater than a threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>U</mi></msub><mo>=</mo><mn>0.6</mn></mrow><annotation encoding="application/x-tex">\theta_{U}=0.6</annotation></semantics></math>
(event A)</li>
<li>The design is to declare futility if the posterior probability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>b</mi><mi>o</mi></mrow></msub><mo>&lt;</mo><msub><mi>P</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>+</mo><mn>5</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">P_{combo} &lt; P_{control}+5\%</annotation></semantics></math>
is greater than a threshold
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>F</mi></msub><mo>=</mo><mn>0.6</mn></mrow><annotation encoding="application/x-tex">\theta_{F}=0.6</annotation></semantics></math>
(event B)</li>
</ul>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>U</mi></msub><annotation encoding="application/x-tex">\theta_{U}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mi>F</mi></msub><annotation encoding="application/x-tex">\theta_{F}</annotation></semantics></math>
are the thresholds set for the posterior probabilities at the final
analysis. 60% is assumed for both of the parameters.</p>
<p>In addition, we assume the study stops at interim when</p>
<ul>
<li>Efficacy stop if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">event A</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>ϕ</mi><mi>U</mi></msub></mrow><annotation encoding="application/x-tex">PP(\text{event A})&gt;\phi_U</annotation></semantics></math>
</li>
<li>Futility stop if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">event B</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>ϕ</mi><mi>F</mi></msub></mrow><annotation encoding="application/x-tex">PP(\text{event B})&gt;\phi_F</annotation></semantics></math>
</li>
</ul>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>U</mi></msub><mo>=</mo><msub><mi>ϕ</mi><mi>F</mi></msub><mo>=</mo><mn>0.8</mn></mrow><annotation encoding="application/x-tex">\phi_U=\phi_F=0.8</annotation></semantics></math>
for illustration.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϕ</mi><mi>F</mi></msub><annotation encoding="application/x-tex">\phi_F</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϕ</mi><mi>U</mi></msub><annotation encoding="application/x-tex">\phi_U</annotation></semantics></math>
are independent thresholds and can be set to unequal values depending on
the need of users.</p>
<div class="section level4">
<h4 id="predictive-probability-calculation-1">Predictive Probability Calculation<a class="anchor" aria-label="anchor" href="#predictive-probability-calculation-1"></a>
</h4>
<p>The following code shows how to utilize the
<code><a href="../reference/predprobDist.html">predprobDist()</a></code> function to calculate the <em>PPs</em>, if
there are 18 PET-CR at the first interim analysis:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PP(event A)</span></span>
<span><span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predprobDist.html">predprobDist</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">18</span>, n <span class="op">=</span> <span class="fl">25</span>, Nmax <span class="op">=</span> <span class="fl">80</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>  thetaT <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span>,</span>
<span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">result</span></span>
<span></span>
<span></span>
<span><span class="co">## PP(event B)</span></span>
<span><span class="va">result2</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="../reference/predprobDist.html">predprobDist</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">18</span>, n <span class="op">=</span> <span class="fl">25</span>, Nmax <span class="op">=</span> <span class="fl">80</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  thetaT <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.6</span>,</span>
<span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span>,</span>
<span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">result</span></span></code></pre></div>
<p>According to the result, study will continue since neither PP(event
A), 57.6%, nor PP(event B), 1.4% exceed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>U</mi></msub><mo>=</mo><msub><mi>ϕ</mi><mi>F</mi></msub><mo>=</mo><mn>80</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">\phi_U=\phi_F=80\%</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="operating-characteristics-evaluation-1">Operating Characteristics Evaluation<a class="anchor" aria-label="anchor" href="#operating-characteristics-evaluation-1"></a>
</h4>
<p>To evaluate the design operating characteristics at an assumed true
PET-CR rate of the combo trial, the <code><a href="../reference/ocPredprobDist.html">ocPredprobDist()</a></code>
function can be used for the advanced PP design as well. To do so,
additional arguments, such as <code>deltaFu</code>, <code>tFu</code> and
<code>phiFu</code> need to be specified. Also, the <code>phiL</code>
argument has to be skipped. To evaluate a scenario with a true response
rate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>75</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">75\%</annotation></semantics></math>,
the following code can be used:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># with 100 simulated trials, assume true PET-CR rate of the combo trial is 40%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="co"># Used for reproducibility</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ocPredprobDist.html">ocPredprobDist</a></span><span class="op">(</span></span>
<span>  nn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">40</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>  truep <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  deltaE <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>  deltaF <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  tT <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  tF <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  phiU <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  phiFu <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.75</span>, <span class="fl">4.25</span><span class="op">)</span>,</span>
<span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">75</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  weightsS <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  sim <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  nnF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">40</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>  wiggle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  decision1 <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in ocPredprobDist(nn = c(25, 40, 80), truep = 0.75, deltaE = 0.15, :</span></span>
<span><span class="co">#&gt; Advise to use sim &gt;= 50000 to achieve convergence</span></span>
<span><span class="va">res1</span><span class="op">$</span><span class="va">oc</span></span>
<span><span class="co">#&gt;   ExpectedN PrStopEarly PrEarlyEff PrEarlyFut PrEfficacy PrFutility PrGrayZone</span></span>
<span><span class="co">#&gt; 1      70.3        0.22          0       0.22        0.7       0.22       0.08</span></span></code></pre></div>
<p>The number of simulation is 10 here to reduce the computational time
of the code. However, user must increase the number to 10,000 or higher
to generate a correct result.</p>
<p>Comparing to the example <a href="#PredProb">earlier</a>, there could
be a gray zone at the final analysis. According to the simulation
result, 6% of the simulated trials declared neither efficacy or futility
at the final analysis (i.e. “gray zone”). The expected sample size,
which is 50, tends to be higher than the one in the example <a href="#PredProb">earlier</a>. 94% of the simulated trials declare
efficacy, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>60</mn><mi>%</mi><mi>/</mi><mn>94</mn><mi>%</mi><mo>=</mo><mn>63.8</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">60\%/94\%=63.8\%</annotation></semantics></math>
of them stop at interim. Besides, none of the simulated trial stop for
futility.</p>
<p>Similar simulation analyses can be conducted for different assumed
true PET-CR rates other than 75%, to have a more complete picture of the
operating characteristics.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="acknowledge">Acknowledgments<a class="anchor" aria-label="anchor" href="#acknowledge"></a>
</h2>
<p>The authors would like to thank everyone that has contributed to the
<code>phase1b</code> R-package, particularly James Lymp who had
implemented the first functions in an earlier version of this
R-package.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-berry:2011" class="csl-entry">
Berry, S. M., B. P. Carlin, J. J. Lee, and P. Müller. 2011. <em>Bayesian
Adaptive Methods for Clinical Trials</em>. Chapman &amp; Hall/CRC
Biostatistics Series. Taylor &amp; Francis.
</div>
<div id="ref-gelman:2013" class="csl-entry">
Gelman, A., J. B. Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, and D.
B. Rubin. 2013. <em>Bayesian Data Analysis, Third Edition</em>. Chapman
&amp; Hall/CRC Texts in Statistical Science. Taylor &amp; Francis. <a href="http://books.google.com/books?id=ZXL6AQAAQBAJ" class="external-link">http://books.google.com/books?id=ZXL6AQAAQBAJ</a>.
</div>
<div id="ref-held-sabanes-2015" class="csl-entry">
Held, Leonhard, and Daniel Sabanés Bové. 2015. <em>Applied Statistical
Inference: Likelihood and Bayes</em>. Springer. <a href="https://link.springer.com/book/10.1007/978-3-642-37887-4" class="external-link">https://link.springer.com/book/10.1007/978-3-642-37887-4</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Sabanes Bove, Markus Elze, Tony Pourmohamad, Jiawen Zhu, James Lymp, Anastasia Teterina, Audrey Yeo, F. Hoffmann-La Roche Ltd.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
