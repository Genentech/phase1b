<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='The trial is stopped for efficacy if the posterior probability to be at
least deltaE better than the control is larger than tU, and stopped for
futility if the posterior probability to be at least deltaF worse than the
control is larger than tL. Otherwise the trial is continued, and at the
maximum sample size it may happen that no decision is made ("gray zone").'><title>Calculate operating characteristics for posterior probability method
with beta prior on SOC — ocPostprobDist • phase1b</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate operating characteristics for posterior probability method
with beta prior on SOC — ocPostprobDist"><meta property="og:description" content='The trial is stopped for efficacy if the posterior probability to be at
least deltaE better than the control is larger than tU, and stopped for
futility if the posterior probability to be at least deltaF worse than the
control is larger than tL. Otherwise the trial is continued, and at the
maximum sample size it may happen that no decision is made ("gray zone").'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-125641273-1');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">phase1b</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">`phase1b`: Tools for Decision Making in Phase 1b Studies</a>
    <a class="dropdown-item" href="../articles/test.html">test</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/genentech/phase1b">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calculate operating characteristics for posterior probability method
with beta prior on SOC</h1>
      <small class="dont-index">Source: <a href="https://github.com/genentech/phase1b/blob/HEAD/R/ocPostprobDist.R" class="external-link"><code>R/ocPostprobDist.R</code></a></small>
      <div class="d-none name"><code>ocPostprobDist.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The trial is stopped for efficacy if the posterior probability to be at
least deltaE better than the control is larger than tU, and stopped for
futility if the posterior probability to be at least deltaF worse than the
control is larger than tL. Otherwise the trial is continued, and at the
maximum sample size it may happen that no decision is made ("gray zone").</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ocPostprobDist</span><span class="op">(</span></span>
<span>  <span class="va">nn</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  <span class="va">deltaE</span>,</span>
<span>  <span class="va">deltaF</span>,</span>
<span>  relativeDelta <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">tL</span>,</span>
<span>  <span class="va">tU</span>,</span>
<span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  ns <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  nr <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  d <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nnF <span class="op">=</span> <span class="va">nn</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>nn</dt>
<dd><p>vector of look locations for efficacy
(if futility looks should be different, please specify also <code>nnF</code>)</p></dd>


<dt>p</dt>
<dd><p>true rate (scenario)</p></dd>


<dt>deltaE</dt>
<dd><p>delta for efficacy: P(pE &gt; pS + deltaE) should be large
to stop for efficacy</p></dd>


<dt>deltaF</dt>
<dd><p>delta for futility: P(pE &lt; pS - deltaF) should be large to
stop for futility</p></dd>


<dt>relativeDelta</dt>
<dd><p>see <code><a href="postprobDist.html">postprobDist</a></code></p></dd>


<dt>tL</dt>
<dd><p>probability threshold for being below control - deltaF</p></dd>


<dt>tU</dt>
<dd><p>probability threshold for being above control + deltaE</p></dd>


<dt>parE</dt>
<dd><p>beta parameters for the prior on the treatment proportion</p></dd>


<dt>parS</dt>
<dd><p>beta parameters for the prior on the control proportion</p></dd>


<dt>ns</dt>
<dd><p>number of simulations</p></dd>


<dt>nr</dt>
<dd><p>generate random look locations? (not default)</p></dd>


<dt>d</dt>
<dd><p>distance for random looks around the look locations in <code>nn</code></p></dd>


<dt>nnF</dt>
<dd><p>vector of look locations for futility
(default: same as efficacy)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with the following elements:
oc: matrix with operating characteristics (see Details section)
Decision: vector of the decisions made in the simulated trials
(<code>TRUE</code> for success, <code>FALSE</code> for failure, <code>NA</code> for no
decision)
SampleSize: vector of the sample sizes in the simulated trials
nn: vector of look locations
nnE: vector of efficacy look locations
nnF: vector of futility look locations
todo: would we like to return nnr instead, the actual look locations?
params: input parameters for this function</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Returned operating characteristics in a matrix include:
ExpectedN: expected number of patients in the trials
PrStopEarly: probability to stop the trial early (before reaching the
maximum sample size)
PrEarlyEff: probability to decide for efficacy early
PrEarlyFut: probability to decide for futility early
PrEfficacy: probability to decide for efficacy
PrFutility: probability to decide for futility
PrGrayZone: probability of no decision at the end ("gray zone")</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># operating characteristics for posterior probability method with beta prior on SOC</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># design details</span></span></span>
<span class="r-in"><span><span class="co"># multiple looks @ 10, 20, 30 patietns</span></span></span>
<span class="r-in"><span><span class="co"># True response rate of the treatment group=0.4</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># stop for efficacy (deltaE): P(pE &gt; pS + deltaE) &gt;tU</span></span></span>
<span class="r-in"><span><span class="co"># stop for futility (deltaF): P(pE &lt; pS - deltaF) &gt;tL</span></span></span>
<span class="r-in"><span><span class="co"># where pE is the response rate of treatment group, pS is the response rate of</span></span></span>
<span class="r-in"><span><span class="co"># control group. Both of them are random variables.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu">ocPostprobDist</span><span class="op">(</span></span></span>
<span class="r-in"><span>  nn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  p <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  deltaE <span class="op">=</span> <span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  deltaF <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  tL <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  tU <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ns <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in (function (x, n, xS = 0, nS = 0, delta, relativeDelta = FALSE,     parE = c(1, 1), weights, parS = c(1, 1), weightsS) {    if (is.vector(parE)) {        assert_true(identical(length(parE), 2L))        parE &lt;- t(parE)    }    if (is.vector(parS)) {        assert_true(identical(length(parS), 2L))        parS &lt;- t(parS)    }    if (missing(weights)) {        weights &lt;- rep(1, nrow(parE))    }    if (missing(weightsS)) {        weightsS &lt;- rep(1, nrow(parS))    }    assert_numeric(x, lower = 0, upper = n, finite = TRUE)    assert_number(n, lower = x, finite = TRUE)    assert_number(xS, lower = 0, upper = n, finite = TRUE)    assert_numeric(nS, lower = 0, finite = TRUE)    assert_number(delta, lower = 0, finite = TRUE)    assert_flag(relativeDelta)    assert_numeric(weights, lower = 0, finite = TRUE)    assert_numeric(weightsS, lower = 0, finite = TRUE)    assert_numeric(parE, lower = 0, finite = TRUE)    assert_numeric(parS, lower = 0, finite = TRUE)    activeBetamixPost &lt;- h_getBetamixPost(x = x, n = n, par = parE,         weights = weights)    controlBetamixPost &lt;- h_getBetamixPost(x = xS, n = nS, par = parS,         weights = weightsS)    assert_names(names(activeBetamixPost), identical.to = c("par",         "weights"))    assert_names(names(controlBetamixPost), identical.to = c("par",         "weights"))    if (relativeDelta) {        epsilon &lt;- .Machine$double.xmin        integrand &lt;- h_integrand_relDelta    }    else {        epsilon &lt;- .Machine$double.xmin        integrand &lt;- h_integrand    }    bounds &lt;- h_get_bounds(controlBetamixPost = controlBetamixPost)    intRes &lt;- integrate(f = integrand, lower = max(bounds[1],         ifelse(relativeDelta, 0, 0 - delta)), upper = min(ifelse(relativeDelta,         1, 1 - delta), bounds[2]), delta = delta, activeBetamixPost = activeBetamixPost,         controlBetamixPost = controlBetamixPost)    if (intRes$message == "OK") {        intRes$value    }    else {        stop(intRes$message)    }})(x = dots[[1L]][[1L]], n = 0, xS = 5L, nS = 10, delta = -0.1,     relativeDelta = FALSE, parE = c(5, 25), parS = c(1, 1)):</span> Assertion on 'xS' failed: Element 1 is not &lt;= 0.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res1</span><span class="op">$</span><span class="va">oc</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'res1' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># generate random look locations around 10,20,30 patients</span></span></span>
<span class="r-in"><span><span class="co"># this call will generate d (distance for random looks around the look locations)</span></span></span>
<span class="r-in"><span><span class="co"># based on "floor(min(nn - c(0,nn[-length(nn)]))/2)" as d is missing:</span></span></span>
<span class="r-in"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu">ocPostprobDist</span><span class="op">(</span></span></span>
<span class="r-in"><span>  nn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  p <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  deltaE <span class="op">=</span> <span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  deltaF <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  tL <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  tU <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ns <span class="op">=</span> <span class="fl">100</span>, nr <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in (function (x, n, xS = 0, nS = 0, delta, relativeDelta = FALSE,     parE = c(1, 1), weights, parS = c(1, 1), weightsS) {    if (is.vector(parE)) {        assert_true(identical(length(parE), 2L))        parE &lt;- t(parE)    }    if (is.vector(parS)) {        assert_true(identical(length(parS), 2L))        parS &lt;- t(parS)    }    if (missing(weights)) {        weights &lt;- rep(1, nrow(parE))    }    if (missing(weightsS)) {        weightsS &lt;- rep(1, nrow(parS))    }    assert_numeric(x, lower = 0, upper = n, finite = TRUE)    assert_number(n, lower = x, finite = TRUE)    assert_number(xS, lower = 0, upper = n, finite = TRUE)    assert_numeric(nS, lower = 0, finite = TRUE)    assert_number(delta, lower = 0, finite = TRUE)    assert_flag(relativeDelta)    assert_numeric(weights, lower = 0, finite = TRUE)    assert_numeric(weightsS, lower = 0, finite = TRUE)    assert_numeric(parE, lower = 0, finite = TRUE)    assert_numeric(parS, lower = 0, finite = TRUE)    activeBetamixPost &lt;- h_getBetamixPost(x = x, n = n, par = parE,         weights = weights)    controlBetamixPost &lt;- h_getBetamixPost(x = xS, n = nS, par = parS,         weights = weightsS)    assert_names(names(activeBetamixPost), identical.to = c("par",         "weights"))    assert_names(names(controlBetamixPost), identical.to = c("par",         "weights"))    if (relativeDelta) {        epsilon &lt;- .Machine$double.xmin        integrand &lt;- h_integrand_relDelta    }    else {        epsilon &lt;- .Machine$double.xmin        integrand &lt;- h_integrand    }    bounds &lt;- h_get_bounds(controlBetamixPost = controlBetamixPost)    intRes &lt;- integrate(f = integrand, lower = max(bounds[1],         ifelse(relativeDelta, 0, 0 - delta)), upper = min(ifelse(relativeDelta,         1, 1 - delta), bounds[2]), delta = delta, activeBetamixPost = activeBetamixPost,         controlBetamixPost = controlBetamixPost)    if (intRes$message == "OK") {        intRes$value    }    else {        stop(intRes$message)    }})(x = dots[[1L]][[1L]], n = 0, xS = 7L, nS = 10, delta = -0.1,     relativeDelta = FALSE, parE = c(5, 25), parS = c(1, 1)):</span> Assertion on 'xS' failed: Element 1 is not &lt;= 0.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res2</span><span class="op">$</span><span class="va">oc</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'res2' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># specify the distance for random looks around the look locations in nn (d=5 for illustration)</span></span></span>
<span class="r-in"><span><span class="va">res3</span> <span class="op">&lt;-</span> <span class="fu">ocPostprobDist</span><span class="op">(</span></span></span>
<span class="r-in"><span>  nn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  p <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  deltaE <span class="op">=</span> <span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  deltaF <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  tL <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  tU <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ns <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  nr <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  d <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in (function (x, n, xS = 0, nS = 0, delta, relativeDelta = FALSE,     parE = c(1, 1), weights, parS = c(1, 1), weightsS) {    if (is.vector(parE)) {        assert_true(identical(length(parE), 2L))        parE &lt;- t(parE)    }    if (is.vector(parS)) {        assert_true(identical(length(parS), 2L))        parS &lt;- t(parS)    }    if (missing(weights)) {        weights &lt;- rep(1, nrow(parE))    }    if (missing(weightsS)) {        weightsS &lt;- rep(1, nrow(parS))    }    assert_numeric(x, lower = 0, upper = n, finite = TRUE)    assert_number(n, lower = x, finite = TRUE)    assert_number(xS, lower = 0, upper = n, finite = TRUE)    assert_numeric(nS, lower = 0, finite = TRUE)    assert_number(delta, lower = 0, finite = TRUE)    assert_flag(relativeDelta)    assert_numeric(weights, lower = 0, finite = TRUE)    assert_numeric(weightsS, lower = 0, finite = TRUE)    assert_numeric(parE, lower = 0, finite = TRUE)    assert_numeric(parS, lower = 0, finite = TRUE)    activeBetamixPost &lt;- h_getBetamixPost(x = x, n = n, par = parE,         weights = weights)    controlBetamixPost &lt;- h_getBetamixPost(x = xS, n = nS, par = parS,         weights = weightsS)    assert_names(names(activeBetamixPost), identical.to = c("par",         "weights"))    assert_names(names(controlBetamixPost), identical.to = c("par",         "weights"))    if (relativeDelta) {        epsilon &lt;- .Machine$double.xmin        integrand &lt;- h_integrand_relDelta    }    else {        epsilon &lt;- .Machine$double.xmin        integrand &lt;- h_integrand    }    bounds &lt;- h_get_bounds(controlBetamixPost = controlBetamixPost)    intRes &lt;- integrate(f = integrand, lower = max(bounds[1],         ifelse(relativeDelta, 0, 0 - delta)), upper = min(ifelse(relativeDelta,         1, 1 - delta), bounds[2]), delta = delta, activeBetamixPost = activeBetamixPost,         controlBetamixPost = controlBetamixPost)    if (intRes$message == "OK") {        intRes$value    }    else {        stop(intRes$message)    }})(x = dots[[1L]][[1L]], n = 0, xS = 5L, nS = 9, delta = -0.1,     relativeDelta = FALSE, parE = c(5, 25), parS = c(1, 1)):</span> Assertion on 'xS' failed: Element 1 is not &lt;= 0.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res3</span><span class="op">$</span><span class="va">oc</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'res3' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># finally, we can also have separate specification of efficacy and futility analyses. E.g.</span></span></span>
<span class="r-in"><span><span class="co"># here have futility decisions only at the final analysis:</span></span></span>
<span class="r-in"><span><span class="va">res4</span> <span class="op">&lt;-</span> <span class="fu">ocPostprobDist</span><span class="op">(</span></span></span>
<span class="r-in"><span>  nn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>, p <span class="op">=</span> <span class="fl">0.4</span>, deltaE <span class="op">=</span> <span class="fl">0.1</span>, deltaF <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, tL <span class="op">=</span> <span class="fl">0.6</span>, tU <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">25</span><span class="op">)</span>, ns <span class="op">=</span> <span class="fl">100</span>, nr <span class="op">=</span> <span class="cn">TRUE</span>, d <span class="op">=</span> <span class="fl">5</span>, nnF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in (function (x, n, xS = 0, nS = 0, delta, relativeDelta = FALSE,     parE = c(1, 1), weights, parS = c(1, 1), weightsS) {    if (is.vector(parE)) {        assert_true(identical(length(parE), 2L))        parE &lt;- t(parE)    }    if (is.vector(parS)) {        assert_true(identical(length(parS), 2L))        parS &lt;- t(parS)    }    if (missing(weights)) {        weights &lt;- rep(1, nrow(parE))    }    if (missing(weightsS)) {        weightsS &lt;- rep(1, nrow(parS))    }    assert_numeric(x, lower = 0, upper = n, finite = TRUE)    assert_number(n, lower = x, finite = TRUE)    assert_number(xS, lower = 0, upper = n, finite = TRUE)    assert_numeric(nS, lower = 0, finite = TRUE)    assert_number(delta, lower = 0, finite = TRUE)    assert_flag(relativeDelta)    assert_numeric(weights, lower = 0, finite = TRUE)    assert_numeric(weightsS, lower = 0, finite = TRUE)    assert_numeric(parE, lower = 0, finite = TRUE)    assert_numeric(parS, lower = 0, finite = TRUE)    activeBetamixPost &lt;- h_getBetamixPost(x = x, n = n, par = parE,         weights = weights)    controlBetamixPost &lt;- h_getBetamixPost(x = xS, n = nS, par = parS,         weights = weightsS)    assert_names(names(activeBetamixPost), identical.to = c("par",         "weights"))    assert_names(names(controlBetamixPost), identical.to = c("par",         "weights"))    if (relativeDelta) {        epsilon &lt;- .Machine$double.xmin        integrand &lt;- h_integrand_relDelta    }    else {        epsilon &lt;- .Machine$double.xmin        integrand &lt;- h_integrand    }    bounds &lt;- h_get_bounds(controlBetamixPost = controlBetamixPost)    intRes &lt;- integrate(f = integrand, lower = max(bounds[1],         ifelse(relativeDelta, 0, 0 - delta)), upper = min(ifelse(relativeDelta,         1, 1 - delta), bounds[2]), delta = delta, activeBetamixPost = activeBetamixPost,         controlBetamixPost = controlBetamixPost)    if (intRes$message == "OK") {        intRes$value    }    else {        stop(intRes$message)    }})(x = dots[[1L]][[1L]], n = 0, xS = 9L, nS = 30, delta = -0.1,     relativeDelta = FALSE, parE = c(5, 25), parS = c(1, 1)):</span> Assertion on 'xS' failed: Element 1 is not &lt;= 0.</span>
<span class="r-in"><span><span class="va">res4</span><span class="op">$</span><span class="va">oc</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'res4' not found</span>
<span class="r-in"><span><span class="co"># compared to res3, we see that there is no early futility stopping anymore,</span></span></span>
<span class="r-in"><span><span class="co"># and the overall probability for stopping for futility (which is the type II error here)</span></span></span>
<span class="r-in"><span><span class="co"># is much lower.</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Daniel Sabanés Bové, Markus Elze, Tony Pourmohamad, Jiawen Zhu, James Lymp, Anastasia Teterina, F. Hoffmann-La Roche Ltd.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

