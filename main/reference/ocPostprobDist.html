<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Operating characteristics of Posterior Probability method with Beta Prior on the Control or Standard of Care Arm — ocPostprobDist • phase1b</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Operating characteristics of Posterior Probability method with Beta Prior on the Control or Standard of Care Arm — ocPostprobDist"><meta name="description" content=""><meta property="og:description" content=""><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-125641273-1');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phase1b</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">`phase1b`: Tools for Decision Making in Phase 1b Studies</a></li>
    <li><a class="dropdown-item" href="../articles/test.html">test</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/genentech/phase1b"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Operating characteristics of Posterior Probability method with Beta Prior on the Control or Standard of Care Arm</h1>
      <small class="dont-index">Source: <a href="https://github.com/genentech/phase1b/blob/main/R/ocPostprobDist.R" class="external-link"><code>R/ocPostprobDist.R</code></a></small>
      <div class="d-none name"><code>ocPostprobDist.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ocPostprobDist</span><span class="op">(</span></span>
<span>  <span class="va">nnE</span>,</span>
<span>  <span class="va">truep</span>,</span>
<span>  <span class="va">deltaE</span>,</span>
<span>  <span class="va">deltaF</span>,</span>
<span>  relativeDelta <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">tL</span>,</span>
<span>  <span class="va">tU</span>,</span>
<span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  wiggle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sim <span class="op">=</span> <span class="fl">50000</span>,</span>
<span>  nnF <span class="op">=</span> <span class="va">nnE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-nne">nnE<a class="anchor" aria-label="anchor" href="#arg-nne"></a></dt>
<dd><p>(<code>numeric</code>):<br> sample size or sizes where study can be stopped for Efficacy decision. If different for Futility decision,
specify in <code>nnF</code>.</p></dd>


<dt id="arg-truep">truep<a class="anchor" aria-label="anchor" href="#arg-truep"></a></dt>
<dd><p>(<code>number</code>):<br> assumed true response rate.</p></dd>


<dt id="arg-deltae">deltaE<a class="anchor" aria-label="anchor" href="#arg-deltae"></a></dt>
<dd><p>(<code>number</code>):<br> margin of which the response rate in the treatment group should be better
than in the standard of care of <code>group</code>. Delta for Efficacy is used to
calculate <code>P(truep &gt; P_S + deltaE)</code> which should
exceed threshold <code>tU</code> to to stop for Efficacy. <code>DeltaE</code> can also be negative in
non-inferiority setting. See also note.</p></dd>


<dt id="arg-deltaf">deltaF<a class="anchor" aria-label="anchor" href="#arg-deltaf"></a></dt>
<dd><p>(<code>number</code>):<br> margin of which the response rate in the treatment group should be better
than in the standard of care of <code>group</code>. Delta for Futility is used to
calculate  <code>P(truep &gt; P_S - deltaF)</code> which should
exceed threshold <code>tL</code> to stop for Futility.<code>DeltaF</code> can also be negative in
non-inferiority setting. See also note.</p></dd>


<dt id="arg-relativedelta">relativeDelta<a class="anchor" aria-label="anchor" href="#arg-relativedelta"></a></dt>
<dd><p>(<code>flag</code>):<br> If <code>TRUE</code>, then a <code>relativeDelta</code> is used. Represents that a minimum
response rate in magnitude of <code>delta</code> of the <code>S</code> non-responding patients
is included as the margin between treatment and control group. See note.</p></dd>


<dt id="arg-tl">tL<a class="anchor" aria-label="anchor" href="#arg-tl"></a></dt>
<dd><p>(<code>number</code>):<br> posterior probability threshold for being below <code>p0</code>.</p></dd>


<dt id="arg-tu">tU<a class="anchor" aria-label="anchor" href="#arg-tu"></a></dt>
<dd><p>(<code>number</code>):<br> posterior probability threshold for being above <code>p1</code>.</p></dd>


<dt id="arg-pare">parE<a class="anchor" aria-label="anchor" href="#arg-pare"></a></dt>
<dd><p>(<code>numeric</code>):<br> alpha and beta parameters for the prior on the treatment population.
Default set at alpha = 1, beta = 1, or uniform prior.</p></dd>


<dt id="arg-pars">parS<a class="anchor" aria-label="anchor" href="#arg-pars"></a></dt>
<dd><p>(<code>numeric</code> or <code>matrix</code>):<br> parameters for beta distribution. If it is a matrix, it needs to have 2 columns,
and each row corresponds to each component of a beta-mixture distribution
for the <code>S</code> group. See details.</p></dd>


<dt id="arg-wiggle">wiggle<a class="anchor" aria-label="anchor" href="#arg-wiggle"></a></dt>
<dd><p>(<code>flag</code>):<br> generate random look locations (not default).
if <code>TRUE</code>, optional to specify <code>dist</code> (see @details).</p></dd>


<dt id="arg-sim">sim<a class="anchor" aria-label="anchor" href="#arg-sim"></a></dt>
<dd><p>(<code>number</code>):<br> number of simulations.</p></dd>


<dt id="arg-nnf">nnF<a class="anchor" aria-label="anchor" href="#arg-nnf"></a></dt>
<dd><p>(<code>numeric</code>):<br> sample size or sizes where study can be stopped for Futility decision if different from Efficacy decision.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The trial is stopped for Efficacy if the posterior probability of assumed
true response rate or <code>truep</code> is better than the control arm by at least
<code>deltaE</code>, is larger than <code>tU</code>. Analogously, The trial is stopped for Efficacy
if the posterior probability of assumed true response rate or <code>truep</code> is
better than the control arm by at least <code>deltaF</code>, is larger than <code>tL</code>
for Futility looks. If these criteria are not met, the trial is continued
and at the maximum sample size, it may reach no decision or "gray zone".The
following represents the stopping criteria for Efficacy and Futility
respectively.</p>
<p>Stop criteria for Efficacy :</p>
<p><code>Pr(truep &gt; P_S + deltaE) &gt; tU</code></p>
<p>Stop criteria for Futility :</p>
<p><code>Pr(truep &lt; P_S + deltaF) &gt; tL</code></p>
<p>Where <code>truep</code> is the assumed true rate of response and <code>p1</code> and <code>p0</code> respectively are
the thresholds for Efficacy and Futility respectively.</p>
<p>Resulting operating characteristics include the following:</p><ul><li><p><code>ExpectedN</code>: expected number of patients in the trials</p></li>
<li><p><code>PrStopEarly</code>: probability to stop the trial early (before reaching the
maximum sample size)</p></li>
<li><p><code>PrEarlyEff</code>: probability of Early Go decision</p></li>
<li><p><code>PrEarlyFut</code>: probability of for Early Stop decision</p></li>
<li><p><code>PrEfficacy</code>: probability of Go decision</p></li>
<li><p><code>PrFutility</code>: probability of Stop decision</p></li>
<li><p><code>PrGrayZone</code>: probability between Go and Stop ,"Evaluate" or Gray decision zone</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>

<div class="section">
<h3 id="delta-">Delta :<a class="anchor" aria-label="anchor" href="#delta-"></a></h3>


<p>The desired improvement is denoted as <code>deltaE</code> or <code>deltaF</code> and two options
exist in its use: The absolute case when <code>relativeDelta = FALSE</code> and
relative as when <code>relativeDelta = TRUE</code>.</p><ol><li><p>The absolute case is when we define an absolute delta, greater than <code>P_S</code>,
the response rate of the standard of care or control or <code>S</code> group such that
the posterior is <code>Pr(truep &gt; P_S + deltaE | data)</code> for Efficacy looks
or <code>Pr(truep &gt; P_S + deltaF | data)</code> for Futility looks.</p></li>
<li><p>In the relative case, we suppose that the treatment group's
response rate is assumed to be greater than <code>P_S + (1-P_S) * delta</code> such that
the posterior is <code>Pr(truep &gt; P_S + (1 - P_S) * deltaE | data)</code> for Efficacy looks
or <code>Pr(truep &gt; P_S + (1 - P_S) * deltaF | data)</code> for Futility looks.</p></li>
</ol></div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># operating characteristics for posterior probability method with beta prior on SOC</span></span></span>
<span class="r-in"><span><span class="co"># For three looks of 10, 20 and 30 we have the following assumptions :</span></span></span>
<span class="r-in"><span><span class="co"># True response rate or truep of the treatment group = 40%</span></span></span>
<span class="r-in"><span><span class="co"># The following are the Go and Stop rules respectively :</span></span></span>
<span class="r-in"><span><span class="co"># Prior of treatment arm parE= Beta(1,1).</span></span></span>
<span class="r-in"><span><span class="co"># stop for efficacy (deltaE): Pr(truep &gt; P_S + deltaE) &gt; tU</span></span></span>
<span class="r-in"><span><span class="co"># stop for futility (deltaF): Pr(truep &lt; P_S + deltaF) &gt; tL</span></span></span>
<span class="r-in"><span><span class="co"># Without random distance allowed for Futility and Efficacy Looks.</span></span></span>
<span class="r-in"><span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu">ocPostprobDist</span><span class="op">(</span></span></span>
<span class="r-in"><span>  nnE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  truep <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  deltaE <span class="op">=</span> <span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  deltaF <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  tL <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  tU <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sim <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>  wiggle <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Advise to use sim &gt;= 50000 to achieve convergence</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res1</span><span class="op">$</span><span class="va">oc</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ExpectedN PrStopEarly PrEarlyEff PrEarlyFut PrEfficacy PrFutility PrGrayZone</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        16        0.72          0       0.72          0       0.84       0.16</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Allow random distance for Efficacy and Futility looks.</span></span></span>
<span class="r-in"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu">ocPostprobDist</span><span class="op">(</span></span></span>
<span class="r-in"><span>  nnE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  truep <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  deltaE <span class="op">=</span> <span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  deltaF <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  tL <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  tU <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sim <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>  wiggle <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Advise to use sim &gt;= 50000 to achieve convergence</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res2</span><span class="op">$</span><span class="va">oc</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ExpectedN PrStopEarly PrEarlyEff PrEarlyFut PrEfficacy PrFutility PrGrayZone</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     14.18         0.9       0.06       0.84       0.06       0.88       0.06</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Allow Futility analysis only at the end.</span></span></span>
<span class="r-in"><span><span class="va">res4</span> <span class="op">&lt;-</span> <span class="fu">ocPostprobDist</span><span class="op">(</span></span></span>
<span class="r-in"><span>  nnE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  truep <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  deltaE <span class="op">=</span> <span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  deltaF <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>  tL <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  tU <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>  parE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  parS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sim <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>  wiggle <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  nnF <span class="op">=</span> <span class="fl">30</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Advise to use sim &gt;= 50000 to achieve convergence</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res4</span><span class="op">$</span><span class="va">oc</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ExpectedN PrStopEarly PrEarlyEff PrEarlyFut PrEfficacy PrFutility PrGrayZone</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        30           0          0          0          0       0.82       0.18</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Sabanes Bove, Markus Elze, Tony Pourmohamad, Jiawen Zhu, James Lymp, Anastasia Teterina, Audrey Yeo, F. Hoffmann-La Roche Ltd.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

